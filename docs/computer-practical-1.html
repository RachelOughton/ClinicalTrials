<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>A Computer Practical 1 | Clinical Trials 4H</title>
  <meta name="description" content="These notes mirror what we’ll follow in lectures for Clinical Trials 4H. If you have any questions or notice any errors, please email me (Rachel Oughton)." />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="A Computer Practical 1 | Clinical Trials 4H" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="These notes mirror what we’ll follow in lectures for Clinical Trials 4H. If you have any questions or notice any errors, please email me (Rachel Oughton)." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A Computer Practical 1 | Clinical Trials 4H" />
  
  <meta name="twitter:description" content="These notes mirror what we’ll follow in lectures for Clinical Trials 4H. If you have any questions or notice any errors, please email me (Rachel Oughton)." />
  

<meta name="author" content="Rachel Oughton" />


<meta name="date" content="2024-01-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="references.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to Clinical Trials 4H!</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#practical-details"><i class="fa fa-check"></i>Practical details</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#lectures"><i class="fa fa-check"></i>Lectures</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#computer-classes"><i class="fa fa-check"></i>Computer classes</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#assessment"><i class="fa fa-check"></i>Assessment</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#books"><i class="fa fa-check"></i>Books</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-to-expect-from-this-module"><i class="fa fa-check"></i>What to expect from this module</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-i-expect-from-you"><i class="fa fa-check"></i>What I expect from you</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="rct-intro.html"><a href="rct-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to Clinical Trials</a>
<ul>
<li class="chapter" data-level="1.1" data-path="rct-intro.html"><a href="rct-intro.html#causal-inference-and-clinical-trials"><i class="fa fa-check"></i><b>1.1</b> Causal inference and clinical trials</a></li>
<li class="chapter" data-level="1.2" data-path="rct-intro.html"><a href="rct-intro.html#the-structure-of-a-clinical-trial"><i class="fa fa-check"></i><b>1.2</b> The structure of a clinical trial</a>
<ul>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#the-population-of-eligible-patients"><i class="fa fa-check"></i>The population of eligible patients</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#entry-to-the-trial"><i class="fa fa-check"></i>Entry to the trial</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#allocation-to-groups"><i class="fa fa-check"></i>Allocation to groups</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#comparing-results"><i class="fa fa-check"></i>Comparing results</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#why-bother-with-a-control-group"><i class="fa fa-check"></i>Why bother with a control group?</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="rct-intro.html"><a href="rct-intro.html#primout"><i class="fa fa-check"></i><b>1.3</b> The primary outcome</a></li>
<li class="chapter" data-level="1.4" data-path="rct-intro.html"><a href="rct-intro.html#ethical-issues"><i class="fa fa-check"></i><b>1.4</b> Ethical issues</a></li>
<li class="chapter" data-level="1.5" data-path="rct-intro.html"><a href="rct-intro.html#phases-of-clinical-trials"><i class="fa fa-check"></i><b>1.5</b> Phases of clinical trials</a>
<ul>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-zero"><i class="fa fa-check"></i>Phase zero</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-one"><i class="fa fa-check"></i>Phase one</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-two"><i class="fa fa-check"></i>Phase two</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-three"><i class="fa fa-check"></i>Phase three</a></li>
<li class="chapter" data-level="" data-path="rct-intro.html"><a href="rct-intro.html#phase-four"><i class="fa fa-check"></i>Phase four</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Part I: Continuous outcome variables</b></span></li>
<li class="chapter" data-level="2" data-path="rct-plan.html"><a href="rct-plan.html"><i class="fa fa-check"></i><b>2</b> Sample size for a normally distributed primary outcome variable</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rct-plan.html"><a href="rct-plan.html#the-treatment-effect"><i class="fa fa-check"></i><b>2.1</b> The treatment effect</a></li>
<li class="chapter" data-level="2.2" data-path="rct-plan.html"><a href="rct-plan.html#reminder-hypothesis-tests-with-a-focus-on-rcts"><i class="fa fa-check"></i><b>2.2</b> Reminder: hypothesis tests (with a focus on RCTs)</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="rct-plan.html"><a href="rct-plan.html#insignificant-results"><i class="fa fa-check"></i><b>2.2.1</b> Insignificant results</a></li>
<li class="chapter" data-level="2.2.2" data-path="rct-plan.html"><a href="rct-plan.html#one-tailed-or-two-tailed"><i class="fa fa-check"></i><b>2.2.2</b> One-tailed or two-tailed?</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="rct-plan.html"><a href="rct-plan.html#sec-measDcont"><i class="fa fa-check"></i><b>2.3</b> Constructing a measure of effect size</a></li>
<li class="chapter" data-level="2.4" data-path="rct-plan.html"><a href="rct-plan.html#sec-power"><i class="fa fa-check"></i><b>2.4</b> Power: If <span class="math inline">\(H_0\)</span> is false</a></li>
<li class="chapter" data-level="2.5" data-path="rct-plan.html"><a href="rct-plan.html#sec-ssformulacont"><i class="fa fa-check"></i><b>2.5</b> A sample size formula</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="allocation.html"><a href="allocation.html"><i class="fa fa-check"></i><b>3</b> Allocation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="allocation.html"><a href="allocation.html#bias"><i class="fa fa-check"></i><b>3.1</b> Bias</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="allocation.html"><a href="allocation.html#where-does-bias-come-from"><i class="fa fa-check"></i><b>3.1.1</b> Where does bias come from?</a></li>
<li class="chapter" data-level="3.1.2" data-path="allocation.html"><a href="allocation.html#implications-for-allocation"><i class="fa fa-check"></i><b>3.1.2</b> Implications for allocation</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="allocation.html"><a href="allocation.html#sec-allocation"><i class="fa fa-check"></i><b>3.2</b> Allocation methods</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="allocation.html"><a href="allocation.html#simple-random-allocation"><i class="fa fa-check"></i><b>3.2.1</b> Simple random allocation</a></li>
<li class="chapter" data-level="3.2.2" data-path="allocation.html"><a href="allocation.html#random-permuted-blocks"><i class="fa fa-check"></i><b>3.2.2</b> Random permuted blocks</a></li>
<li class="chapter" data-level="3.2.3" data-path="allocation.html"><a href="allocation.html#biased-coin-designs-and-urn-schemes"><i class="fa fa-check"></i><b>3.2.3</b> Biased coin designs and urn schemes</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="allocation.html"><a href="allocation.html#incorporating-baseline-measurements"><i class="fa fa-check"></i><b>3.3</b> Incorporating baseline measurements</a></li>
<li class="chapter" data-level="3.4" data-path="allocation.html"><a href="allocation.html#stratified-sampling"><i class="fa fa-check"></i><b>3.4</b> Stratified sampling</a></li>
<li class="chapter" data-level="3.5" data-path="allocation.html"><a href="allocation.html#minimization"><i class="fa fa-check"></i><b>3.5</b> Minimization</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="allocation.html"><a href="allocation.html#minimization-algorithm"><i class="fa fa-check"></i><b>3.5.1</b> Minimization algorithm</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="allocation.html"><a href="allocation.html#problems-around-allocation"><i class="fa fa-check"></i><b>3.6</b> Problems around allocation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rct-analysis.html"><a href="rct-analysis.html"><i class="fa fa-check"></i><b>4</b> Analyzing RCT data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rct-analysis.html"><a href="rct-analysis.html#ttest"><i class="fa fa-check"></i><b>4.1</b> Confidence intervals and P-values</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="rct-analysis.html"><a href="rct-analysis.html#what-do-we-do-with-this-outcome"><i class="fa fa-check"></i><b>4.1.1</b> What do we do with this outcome?</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="rct-analysis.html"><a href="rct-analysis.html#baseline"><i class="fa fa-check"></i><b>4.2</b> Using baseline values</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rct-analysis.html"><a href="rct-analysis.html#a-dodgy-way-to-use-baseline-variables"><i class="fa fa-check"></i><b>4.2.1</b> A dodgy way to use baseline variables</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rct-analysis.html"><a href="rct-analysis.html#analysis-of-covariance-ancova"><i class="fa fa-check"></i><b>4.3</b> Analysis of covariance (ANCOVA)</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="rct-analysis.html"><a href="rct-analysis.html#ancovatheory"><i class="fa fa-check"></i><b>4.3.1</b> The theory</a></li>
<li class="chapter" data-level="4.3.2" data-path="rct-analysis.html"><a href="rct-analysis.html#the-practice"><i class="fa fa-check"></i><b>4.3.2</b> The practice</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="rct-analysis.html"><a href="rct-analysis.html#some-follow-up-questions."><i class="fa fa-check"></i><b>4.4</b> Some follow-up questions….</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="rct-analysis.html"><a href="rct-analysis.html#didnt-we-say-that-x_t---x_c-was-an-unbiased-estimator-of-tau"><i class="fa fa-check"></i><b>4.4.1</b> Didn’t we say that <span class="math inline">\(X_T - X_C\)</span> was an unbiased estimator of <span class="math inline">\(\tau\)</span>?</a></li>
<li class="chapter" data-level="4.4.2" data-path="rct-analysis.html"><a href="rct-analysis.html#what-if-the-lines-shouldnt-be-parallel-the-unequal-slopes-model"><i class="fa fa-check"></i><b>4.4.2</b> What if the lines shouldn’t be parallel? The unequal slopes model</a></li>
<li class="chapter" data-level="4.4.3" data-path="rct-analysis.html"><a href="rct-analysis.html#can-we-include-any-other-baseline-covariates"><i class="fa fa-check"></i><b>4.4.3</b> Can we include any other baseline covariates?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="appendix"><span><b>Computer practicals</b></span></li>
<li class="chapter" data-level="A" data-path="computer-practical-1.html"><a href="computer-practical-1.html"><i class="fa fa-check"></i><b>A</b> Computer Practical 1</a>
<ul>
<li class="chapter" data-level="A.1" data-path="computer-practical-1.html"><a href="computer-practical-1.html#cp1allocation"><i class="fa fa-check"></i><b>A.1</b> Allocation</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="computer-practical-1.html"><a href="computer-practical-1.html#example-dataset"><i class="fa fa-check"></i><b>A.1.1</b> Example dataset</a></li>
<li class="chapter" data-level="A.1.2" data-path="computer-practical-1.html"><a href="computer-practical-1.html#allocmethods"><i class="fa fa-check"></i><b>A.1.2</b> Allocation methods</a></li>
<li class="chapter" data-level="A.1.3" data-path="computer-practical-1.html"><a href="computer-practical-1.html#stratifying-the-dataset"><i class="fa fa-check"></i><b>A.1.3</b> Stratifying the dataset</a></li>
<li class="chapter" data-level="A.1.4" data-path="computer-practical-1.html"><a href="computer-practical-1.html#minimisation"><i class="fa fa-check"></i><b>A.1.4</b> Minimisation</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="computer-practical-1.html"><a href="computer-practical-1.html#cp1analysis"><i class="fa fa-check"></i><b>A.2</b> Analysis</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Clinical Trials 4H</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="computer-practical-1" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">A</span> Computer Practical 1<a href="computer-practical-1.html#computer-practical-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This computer practical will cover two main parts:</p>
<ol style="list-style-type: decimal">
<li>Allocation (Section <a href="computer-practical-1.html#cp1allocation">A.1</a>)</li>
<li>Analysis (Section (<a href="computer-practical-1.html#cp1analysis">A.2</a>)</li>
</ol>
<p>The idea is that you spend roughly half the time on each part, but there is probably more content for allocation. It might be a good idea to do work through some of the allocation exercises, jump ahead to analysis after a while, then go back to allocation if you have time.</p>
<p>There are many, many packages in R that implement methods for designing and analysiing clinical trials (see a list at <a href="https://cran.r-project.org/web/views/ClinicalTrials.html">CRAN task view</a>). We will look at some of these, and will also write our own code for some tasks. Remember that to install a package, you can do</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="computer-practical-1.html#cb10-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;&lt;packagename&gt;&quot;</span>)</span></code></pre></div>
<p>If you have problems running R on you local machine, or on the university machines, the most foolproof way might be to use Github codespaces (thanks to Louis Aslett, who developed this for Data Science and Statistical Computing II). An advantage of this is that you can open the same codespace (the same instance of R) from any computer, so if you plan to work on things (for example your summative assignment, which will involve some R) from more than one computer, this might be ideal.</p>
<p>This requires you to have a github account (you can sign up for free <a href="https://github.com/">here</a>) and there is a short guide to creating a github account <a href="https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.louisaslett.com%2FCourses%2FDSSC%2Fnotes%2Fgithub.html&amp;data=05%7C02%7Cr.h.oughton%40durham.ac.uk%7Ccd09b90284364f8558ba08dc1ccf06f8%7C7250d88b4b684529be44d59a2d8a6f94%7C0%7C0%7C638416922691502641%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=f5gJFI3CJPOQ1P16l%2FIdhtIAgQul7s5BhIPwi4GAyLk%3D&amp;reserved=0">here</a>.</p>
<p><a href="https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fcodespaces.new%2Flouisaslett%2Fdssc%3Fquickstart%3D1&amp;data=05%7C02%7Cr.h.oughton%40durham.ac.uk%7Ccd09b90284364f8558ba08dc1ccf06f8%7C7250d88b4b684529be44d59a2d8a6f94%7C0%7C0%7C638416922691485947%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=Lsw6mz0L5G%2FvZoZN29D2FgOyOkPMNboJgXPJt7BMPk8%3D&amp;reserved=0">Direct link to codespace</a></p>
<p><a href="https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fwww.louisaslett.com%2FCourses%2FDSSC%2Fnotes%2Finstallr.html%23codespaces&amp;data=05%7C02%7Cr.h.oughton%40durham.ac.uk%7Ccd09b90284364f8558ba08dc1ccf06f8%7C7250d88b4b684529be44d59a2d8a6f94%7C0%7C0%7C638416922691495230%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&amp;sdata=hNtp7fT0qZWiQXRwEOUXbMvPWxy1jMtsCd9J7nXlAug%3D&amp;reserved=0">Instructions for how to use codespace</a></p>
<div id="cp1allocation" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">A.1</span> Allocation<a href="computer-practical-1.html#cp1allocation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ll make use of several packages in this section. Installing them all now should hopefully prevent it from disrupting your flow!</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="computer-practical-1.html#cb11-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;medicaldata&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;Minirand&quot;</span>, <span class="st">&quot;blockrand&quot;</span>, <span class="st">&quot;dplyr&quot;</span>))</span></code></pre></div>
<div id="example-dataset" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">A.1.1</span> Example dataset<a href="computer-practical-1.html#example-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To work with allocation, we will use the <code>licorice_gargle</code> dataset from the package <code>medicaldata</code>, which you can find by</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="computer-practical-1.html#cb12-1" tabindex="-1"></a><span class="fu">library</span>(medicaldata)</span>
<span id="cb12-2"><a href="computer-practical-1.html#cb12-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;licorice_gargle&quot;</span>)</span></code></pre></div>
<p>You can find out about the dataset by looking at the help file</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="computer-practical-1.html#cb13-1" tabindex="-1"></a>?licorice_gargle</span></code></pre></div>
<p>and at <a href="https://www.causeweb.org/tshs/licorice-gargle/">this website</a>, even the original paper <span class="citation">Ruetzler et al. (<a href="#ref-ruetzler2013randomized">2013</a>)</span>.</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-25" class="exercise"><strong>Exercise A.1  </strong></span>Of the 19 columns, how many are baseline characteristics that we could use in the allocation?</p>
</div>
<p>In order to be able to work with the dataset, we need to convert several of the columns to factor variables (you can see by looking at the structure <code>str(licorice_gargle)</code> that all columns are numeric to begin with).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="computer-practical-1.html#cb14-1" tabindex="-1"></a>lic_garg <span class="ot">=</span> licorice_gargle[ ,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>]</span>
<span id="cb14-2"><a href="computer-practical-1.html#cb14-2" tabindex="-1"></a><span class="co"># vector of names of columns to be coerced to factor</span></span>
<span id="cb14-3"><a href="computer-practical-1.html#cb14-3" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;preOp_gender&quot;</span>, <span class="st">&quot;preOp_asa&quot;</span>,  </span>
<span id="cb14-4"><a href="computer-practical-1.html#cb14-4" tabindex="-1"></a><span class="st">&quot;preOp_mallampati&quot;</span>, <span class="st">&quot;preOp_smoking&quot;</span>, <span class="st">&quot;preOp_pain&quot;</span>, <span class="st">&quot;treat&quot;</span>)</span>
<span id="cb14-5"><a href="computer-practical-1.html#cb14-5" tabindex="-1"></a><span class="co"># convert each of those columns to factors</span></span>
<span id="cb14-6"><a href="computer-practical-1.html#cb14-6" tabindex="-1"></a>lic_garg[cols] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(lic_garg[cols], factor) </span>
<span id="cb14-7"><a href="computer-practical-1.html#cb14-7" tabindex="-1"></a></span>
<span id="cb14-8"><a href="computer-practical-1.html#cb14-8" tabindex="-1"></a><span class="co"># Check the result:</span></span>
<span id="cb14-9"><a href="computer-practical-1.html#cb14-9" tabindex="-1"></a><span class="fu">str</span>(lic_garg)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    235 obs. of  8 variables:
##  $ preOp_gender    : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ preOp_asa       : Factor w/ 3 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 3 2 2 2 1 2 3 2 3 3 ...
##  $ preOp_calcBMI   : num  33 23.7 26.8 28.4 30.4 ...
##  $ preOp_age       : num  67 76 58 59 73 61 66 61 83 69 ...
##  $ preOp_mallampati: Factor w/ 4 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;: 2 2 2 2 1 3 1 2 1 2 ...
##  $ preOp_smoking   : Factor w/ 3 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;: 1 2 1 1 2 1 1 1 1 3 ...
##  $ preOp_pain      : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ treat           : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 2 2 2 2 2 2 2 2 2 ...</code></pre>
<p>It’s also useful to get some idea of how the data are distributed.</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-26" class="exercise"><strong>Exercise A.2  </strong></span>Plot the data in various different ways. For example,</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="computer-practical-1.html#cb16-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>lic_garg, <span class="fu">aes</span>(<span class="at">x=</span>preOp_pain, <span class="at">fill=</span>preOp_gender)) <span class="sc">+</span> </span>
<span id="cb16-2"><a href="computer-practical-1.html#cb16-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">col=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb16-3"><a href="computer-practical-1.html#cb16-3" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>preOp_smoking, <span class="at">nrow=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="computer-practical-1.html#cb16-4" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p>will generate bar charts of pre-operative pain (0=No, 1=Yes) coloured by gender (0=Male, 1=Female), for each smoking category (1=Current, 2=Past, 3=Never).</p>
<p>Are there any ways in which you think this data set would be particularly vulnerable to leading to a biased trial?</p>
</div>
<div id="demographic-tables" class="section level4 hasAnchor" number="5.1.1.1">
<h4><span class="header-section-number">A.1.1.1</span> Demographic tables<a href="computer-practical-1.html#demographic-tables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>For every allocation, we’ll want to see a summary table of how the patients are distributed between the groups. In this practical we’ll use a relatively simple method, detailed <a href="https://www.rdocumentation.org/packages/Minirand/versions/0.1.3/topics/randbalance">here</a> from the package <code>Minirand</code>, which is designed to output a table in the R console.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="computer-practical-1.html#cb17-1" tabindex="-1"></a><span class="fu">library</span>(Minirand)</span>
<span id="cb17-2"><a href="computer-practical-1.html#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="computer-practical-1.html#cb17-3" tabindex="-1"></a><span class="fu">randbalance</span>(</span>
<span id="cb17-4"><a href="computer-practical-1.html#cb17-4" tabindex="-1"></a>  <span class="at">trt =</span> lic_garg<span class="sc">$</span>treat, </span>
<span id="cb17-5"><a href="computer-practical-1.html#cb17-5" tabindex="-1"></a>  <span class="at">covmat =</span> lic_garg[,<span class="sc">-</span><span class="dv">8</span>], </span>
<span id="cb17-6"><a href="computer-practical-1.html#cb17-6" tabindex="-1"></a>  <span class="at">ntrt=</span><span class="dv">2</span>, </span>
<span id="cb17-7"><a href="computer-practical-1.html#cb17-7" tabindex="-1"></a>  <span class="at">trtseq =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>))</span></code></pre></div>
<p>Notice that we can also save this as an object and access the individual sub-tables, for example</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="computer-practical-1.html#cb18-1" tabindex="-1"></a>rb_tab <span class="ot">=</span> <span class="fu">randbalance</span>(</span>
<span id="cb18-2"><a href="computer-practical-1.html#cb18-2" tabindex="-1"></a>  <span class="at">trt =</span> lic_garg<span class="sc">$</span>treat, </span>
<span id="cb18-3"><a href="computer-practical-1.html#cb18-3" tabindex="-1"></a>  <span class="at">covmat =</span> lic_garg[,<span class="sc">-</span><span class="dv">8</span>], </span>
<span id="cb18-4"><a href="computer-practical-1.html#cb18-4" tabindex="-1"></a>  <span class="at">ntrt=</span><span class="dv">2</span>, </span>
<span id="cb18-5"><a href="computer-practical-1.html#cb18-5" tabindex="-1"></a>  <span class="at">trtseq =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>))</span>
<span id="cb18-6"><a href="computer-practical-1.html#cb18-6" tabindex="-1"></a>rb_tab<span class="sc">$</span>preOp_gender</span></code></pre></div>
<pre><code>##    
## trt  0  1
##   0 73 44
##   1 69 49</code></pre>
<p>There are also packages with functions to output these demographic tables formatted for use in latex documents, for example <a href="https://journal.r-project.org/archive/2019/RJ-2019-001/RJ-2019-001.pdf"><code>atable</code></a>.</p>
</div>
<div id="binning-continuous-variables" class="section level4 hasAnchor" number="5.1.1.2">
<h4><span class="header-section-number">A.1.1.2</span> Binning continuous variables<a href="computer-practical-1.html#binning-continuous-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Looking at the output above, it’s clear that the two numeric variables <code>preOp_age</code> and <code>preOp_calcBMI</code> are going to complicate things.</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-27" class="exercise"><strong>Exercise A.3  </strong></span>Bin the two variables <code>preOp_age</code> and <code>preOp_calcBMI</code> to convert them into factor variables <code>BMI</code> and <code>age</code>.</p>
<p>Create a new data frame <code>lg_df</code> with these two factor variables instead of the original two numeric variables.</p>
</div>
<details>
<summary>
Click for solution
</summary>
<p>These solutions show you one way to create such factor variables, but if you choose different bins that’s fine!</p>
<p>One approach is to look at the distribution of the variables. For example for age:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="computer-practical-1.html#cb20-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>lic_garg) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>preOp_age), <span class="at">binwidth=</span><span class="dv">5</span>)</span></code></pre></div>
<p><img src="CT4H_notes_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>Based on this, one reasonable split would be <span class="math inline">\(&lt;50,\;50-70\)</span> and <span class="math inline">\(&gt;70\)</span>, in which case we could do</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="computer-practical-1.html#cb21-1" tabindex="-1"></a>lic_garg<span class="sc">$</span>age[lic_garg<span class="sc">$</span>preOp_age <span class="sc">&lt;</span> <span class="dv">50</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Under 50&quot;</span></span>
<span id="cb21-2"><a href="computer-practical-1.html#cb21-2" tabindex="-1"></a>lic_garg<span class="sc">$</span>age[lic_garg<span class="sc">$</span>preOp_age <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> lic_garg<span class="sc">$</span>preOp_age <span class="sc">&lt;</span> <span class="dv">70</span>] <span class="ot">&lt;-</span> <span class="st">&quot;50 to 70&quot;</span></span>
<span id="cb21-3"><a href="computer-practical-1.html#cb21-3" tabindex="-1"></a>lic_garg<span class="sc">$</span>age[lic_garg<span class="sc">$</span>preOp_age <span class="sc">&gt;=</span> <span class="dv">70</span>] <span class="ot">&lt;-</span> <span class="st">&quot;70 plus&quot;</span></span>
<span id="cb21-4"><a href="computer-practical-1.html#cb21-4" tabindex="-1"></a>lic_garg<span class="sc">$</span>age <span class="ot">=</span> <span class="fu">as.factor</span>(lic_garg<span class="sc">$</span>age)</span></code></pre></div>
<p>Another approach is to bin the variable according to pre-defined categories, which we could do with BMI, for example</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="computer-practical-1.html#cb22-1" tabindex="-1"></a>lic_garg<span class="sc">$</span>BMI[lic_garg<span class="sc">$</span>preOp_calcBMI <span class="sc">&lt;</span> <span class="fl">18.5</span>] <span class="ot">&lt;-</span> <span class="st">&quot;low&quot;</span></span>
<span id="cb22-2"><a href="computer-practical-1.html#cb22-2" tabindex="-1"></a>lic_garg<span class="sc">$</span>BMI[lic_garg<span class="sc">$</span>preOp_calcBMI <span class="sc">&gt;=</span> <span class="fl">18.5</span> <span class="sc">&amp;</span> lic_garg<span class="sc">$</span>preOp_calcBMI <span class="sc">&lt;</span> <span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="st">&quot;medium&quot;</span></span>
<span id="cb22-3"><a href="computer-practical-1.html#cb22-3" tabindex="-1"></a>lic_garg<span class="sc">$</span>BMI[lic_garg<span class="sc">$</span>preOp_calcBMI <span class="sc">&gt;=</span> <span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="st">&quot;high&quot;</span></span>
<span id="cb22-4"><a href="computer-practical-1.html#cb22-4" tabindex="-1"></a>lic_garg<span class="sc">$</span>BMI <span class="ot">=</span> <span class="fu">as.factor</span>(lic_garg<span class="sc">$</span>BMI)</span></code></pre></div>
<p>Finally, we can select the columns we want from <code>lic_garg</code> to create <code>lg_df</code></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="computer-practical-1.html#cb23-1" tabindex="-1"></a>lg_df <span class="ot">=</span> lic_garg[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">8</span>)]</span></code></pre></div>
<p>If you’ve chosen different bins, that’s fine! But it will help you if the column names and data frame names are the same as on this page.</p>
</details>
<p>To mimic the way that participants are recruited sequentially in a trial (which is generally the case), the code for each type of allocation will work its way through the participant data frame, even though this might not be the most efficient way to produce the end result. For the more complex methods we’ll use packages. Feel free to write your own code for the simpler methods if you want to!</p>
<p>We’ll start by performing each method once, and then go on to perform a more thorough simulation study.</p>
</div>
</div>
<div id="allocmethods" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">A.1.2</span> Allocation methods<a href="computer-practical-1.html#allocmethods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="simple-random-allocation-1" class="section level4 hasAnchor" number="5.1.2.1">
<h4><span class="header-section-number">A.1.2.1</span> Simple random allocation<a href="computer-practical-1.html#simple-random-allocation-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In simple random allocation, each participant is allocated to one of the two trial arms with equal probability. At this point we don’t need to think about the prognostic factors at all.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="computer-practical-1.html#cb24-1" tabindex="-1"></a>srs <span class="ot">=</span> <span class="cf">function</span>(</span>
<span id="cb24-2"><a href="computer-practical-1.html#cb24-2" tabindex="-1"></a>    df, <span class="co"># DF should be the participant data frame. </span></span>
<span id="cb24-3"><a href="computer-practical-1.html#cb24-3" tabindex="-1"></a>        <span class="co"># A column &#39;treat&#39; will be added</span></span>
<span id="cb24-4"><a href="computer-practical-1.html#cb24-4" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>), <span class="co"># Levels of treat factor</span></span>
<span id="cb24-5"><a href="computer-practical-1.html#cb24-5" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">92220</span> <span class="co"># A random seed, so that this is reproducible</span></span>
<span id="cb24-6"><a href="computer-practical-1.html#cb24-6" tabindex="-1"></a>){</span>
<span id="cb24-7"><a href="computer-practical-1.html#cb24-7" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">nrow</span>(df) <span class="co"># number of rows / participants</span></span>
<span id="cb24-8"><a href="computer-practical-1.html#cb24-8" tabindex="-1"></a><span class="co"># Create a new column &#39;treat&#39;</span></span>
<span id="cb24-9"><a href="computer-practical-1.html#cb24-9" tabindex="-1"></a>  df<span class="sc">$</span>treat <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)</span>
<span id="cb24-10"><a href="computer-practical-1.html#cb24-10" tabindex="-1"></a><span class="co"># work through the rows, randomly allocating patients with probably 1/2</span></span>
<span id="cb24-11"><a href="computer-practical-1.html#cb24-11" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb24-12"><a href="computer-practical-1.html#cb24-12" tabindex="-1"></a>    df<span class="sc">$</span>treat[i] <span class="ot">=</span> <span class="fu">sample</span>(levels, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb24-13"><a href="computer-practical-1.html#cb24-13" tabindex="-1"></a>  }</span>
<span id="cb24-14"><a href="computer-practical-1.html#cb24-14" tabindex="-1"></a>  df<span class="sc">$</span>treat <span class="ot">=</span> <span class="fu">as.factor</span>(df<span class="sc">$</span>treat)</span>
<span id="cb24-15"><a href="computer-practical-1.html#cb24-15" tabindex="-1"></a>  df</span>
<span id="cb24-16"><a href="computer-practical-1.html#cb24-16" tabindex="-1"></a>}</span></code></pre></div>
<div class="exercise">
<p><span id="exr:unlabeled-div-28" class="exercise"><strong>Exercise A.4  </strong></span>Use the function <code>srs</code> above to allocate the patients in the <code>licorice_gargle</code> dataset to groups T or C.</p>
<p>Generate the balance table and comment on it.</p>
</div>
<details>
<summary>
Click for solution
</summary>
<p>To allocate the patients, use</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="computer-practical-1.html#cb25-1" tabindex="-1"></a>lg_srs <span class="ot">=</span> <span class="fu">srs</span>(</span>
<span id="cb25-2"><a href="computer-practical-1.html#cb25-2" tabindex="-1"></a>  <span class="at">df =</span> lg_df[,<span class="sc">-</span><span class="dv">7</span>],</span>
<span id="cb25-3"><a href="computer-practical-1.html#cb25-3" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;C&quot;</span>)</span>
<span id="cb25-4"><a href="computer-practical-1.html#cb25-4" tabindex="-1"></a>)</span></code></pre></div>
<p>And to display the balance table</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="computer-practical-1.html#cb26-1" tabindex="-1"></a>rb_tab <span class="ot">=</span> <span class="fu">randbalance</span>(</span>
<span id="cb26-2"><a href="computer-practical-1.html#cb26-2" tabindex="-1"></a>  <span class="at">trt =</span> lg_srs<span class="sc">$</span>treat, </span>
<span id="cb26-3"><a href="computer-practical-1.html#cb26-3" tabindex="-1"></a>  <span class="at">covmat =</span> lg_srs[,<span class="sc">-</span><span class="dv">8</span>], </span>
<span id="cb26-4"><a href="computer-practical-1.html#cb26-4" tabindex="-1"></a>  <span class="at">ntrt=</span><span class="dv">2</span>, </span>
<span id="cb26-5"><a href="computer-practical-1.html#cb26-5" tabindex="-1"></a>  <span class="at">trtseq =</span> <span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;C&quot;</span>))</span></code></pre></div>
</details>
</div>
<div id="randomly-permuted-blocks" class="section level4 hasAnchor" number="5.1.2.2">
<h4><span class="header-section-number">A.1.2.2</span> Randomly permuted blocks<a href="computer-practical-1.html#randomly-permuted-blocks" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>An obvious problem with using RPBs for this data is the number of strata. We have (if you have the same numbers of levels for <code>age</code> and <code>BMI</code> as I do)</p>
<p><span class="math display">\[2\times{3}\times{4}\times{3}\times{2}\times{3}\times{3} = 1296 \]</span>
strata. Even by collecting levels together and so on, we are not going to get down to a sufficiently small number of strata. Therefore we will start by using RPBs without stratification. We will do this with the package <code>blockrand</code>.</p>
<p>The default for the function <code>blockrand</code> is that it will randomly vary block length within <span class="math inline">\(\left\lbrace 2,\,4,\,6,\,8 \right\rbrace\)</span>.</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-29" class="exercise"><strong>Exercise A.5  </strong></span>Try playing around with the function <code>blockrand</code>, for example starting with</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="computer-practical-1.html#cb27-1" tabindex="-1"></a><span class="fu">blockrand</span>(<span class="at">n=</span><span class="dv">100</span>)</span></code></pre></div>
<p>Can you generate an allocation for the <code>licorice_gargle</code> data (remember our data frame is now <code>lg_df</code>) and produce the balance table?</p>
</div>
<details>
<summary>
Click for solution
</summary>
<p>There are 235 rows/participants in <code>lg_df</code>, and to keep consistency we would like the levels of our treatment to be <code>"T"</code> and <code>"C"</code>. Therefore we can do</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="computer-practical-1.html#cb28-1" tabindex="-1"></a>rpb_lg <span class="ot">=</span> <span class="fu">blockrand</span>(<span class="at">n=</span><span class="dv">235</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;C&quot;</span>))</span></code></pre></div>
<p>Notice that this doesn’t have 235 rows: the <code>blockrand</code> function will always finish after a whole block.</p>
<p>Let’s add this to our participant data to create a new data frame <code>lg_rpb</code>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="computer-practical-1.html#cb29-1" tabindex="-1"></a><span class="co"># create the new data frame, a copy of lg_df</span></span>
<span id="cb29-2"><a href="computer-practical-1.html#cb29-2" tabindex="-1"></a>lg_rpb <span class="ot">=</span> lg_df  </span>
<span id="cb29-3"><a href="computer-practical-1.html#cb29-3" tabindex="-1"></a></span>
<span id="cb29-4"><a href="computer-practical-1.html#cb29-4" tabindex="-1"></a><span class="co"># Replace the original treat column with the RPB treatment column</span></span>
<span id="cb29-5"><a href="computer-practical-1.html#cb29-5" tabindex="-1"></a><span class="co"># Using only the first 235 allocations</span></span>
<span id="cb29-6"><a href="computer-practical-1.html#cb29-6" tabindex="-1"></a>lg_rpb<span class="sc">$</span>treat <span class="ot">=</span> rpb_lg<span class="sc">$</span>treatment[<span class="dv">1</span><span class="sc">:</span><span class="dv">235</span>]</span></code></pre></div>
<p>Then we can generate the demographic table as before:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="computer-practical-1.html#cb30-1" tabindex="-1"></a><span class="fu">randbalance</span>(</span>
<span id="cb30-2"><a href="computer-practical-1.html#cb30-2" tabindex="-1"></a>  <span class="at">trt =</span> lg_rpb<span class="sc">$</span>treat, </span>
<span id="cb30-3"><a href="computer-practical-1.html#cb30-3" tabindex="-1"></a>  <span class="at">covmat =</span> lg_rpb[,<span class="sc">-</span><span class="dv">8</span>], </span>
<span id="cb30-4"><a href="computer-practical-1.html#cb30-4" tabindex="-1"></a>  <span class="at">ntrt=</span><span class="dv">2</span>, </span>
<span id="cb30-5"><a href="computer-practical-1.html#cb30-5" tabindex="-1"></a>  <span class="at">trtseq =</span> <span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;C&quot;</span>))</span></code></pre></div>
</details>
<p>The package <code>blockrand</code> contains a function <code>plotblockrand</code> outputs PDFs of randomization cards, ready to be printed and put into envelopes!</p>
</div>
<div id="biased-coin-designs-1" class="section level4 hasAnchor" number="5.1.2.3">
<h4><span class="header-section-number">A.1.2.3</span> Biased coin designs<a href="computer-practical-1.html#biased-coin-designs-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can write code for a biased coin design by adapting the <code>srs</code> function above, setting <span class="math inline">\(p=\frac{2}{3}\)</span> by default as per <span class="citation">Efron (<a href="#ref-efron1971forcing">1971</a>)</span>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="computer-practical-1.html#cb31-1" tabindex="-1"></a>biased_coin <span class="ot">=</span> <span class="cf">function</span>(</span>
<span id="cb31-2"><a href="computer-practical-1.html#cb31-2" tabindex="-1"></a>    data,</span>
<span id="cb31-3"><a href="computer-practical-1.html#cb31-3" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;C&quot;</span>),</span>
<span id="cb31-4"><a href="computer-practical-1.html#cb31-4" tabindex="-1"></a>    <span class="at">p=</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span></span>
<span id="cb31-5"><a href="computer-practical-1.html#cb31-5" tabindex="-1"></a>){</span>
<span id="cb31-6"><a href="computer-practical-1.html#cb31-6" tabindex="-1"></a>  Dn <span class="ot">=</span> <span class="dv">0</span> <span class="co"># starting value of imbalance</span></span>
<span id="cb31-7"><a href="computer-practical-1.html#cb31-7" tabindex="-1"></a>  n <span class="ot">=</span> <span class="fu">nrow</span>(data)</span>
<span id="cb31-8"><a href="computer-practical-1.html#cb31-8" tabindex="-1"></a>  alloc <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n)</span>
<span id="cb31-9"><a href="computer-practical-1.html#cb31-9" tabindex="-1"></a>  </span>
<span id="cb31-10"><a href="computer-practical-1.html#cb31-10" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb31-11"><a href="computer-practical-1.html#cb31-11" tabindex="-1"></a>    <span class="cf">if</span> (Dn<span class="sc">==</span><span class="dv">0</span>){ <span class="co"># equally balanced</span></span>
<span id="cb31-12"><a href="computer-practical-1.html#cb31-12" tabindex="-1"></a>      alloc[i] <span class="ot">=</span> <span class="fu">sample</span>(levels, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>) )</span>
<span id="cb31-13"><a href="computer-practical-1.html#cb31-13" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(Dn<span class="sc">&lt;</span><span class="dv">0</span>){ <span class="co"># More allocations to levels[2] up to this point</span></span>
<span id="cb31-14"><a href="computer-practical-1.html#cb31-14" tabindex="-1"></a>      alloc[i] <span class="ot">=</span> <span class="fu">sample</span>(levels, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span><span class="fu">c</span>(p, <span class="dv">1</span><span class="sc">-</span>p) )</span>
<span id="cb31-15"><a href="computer-practical-1.html#cb31-15" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(Dn<span class="sc">&gt;</span><span class="dv">0</span>){ <span class="co"># More allocations to levels[1] up to this point</span></span>
<span id="cb31-16"><a href="computer-practical-1.html#cb31-16" tabindex="-1"></a>      alloc[i] <span class="ot">=</span> <span class="fu">sample</span>(levels, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">-</span>p, p) )</span>
<span id="cb31-17"><a href="computer-practical-1.html#cb31-17" tabindex="-1"></a>    }</span>
<span id="cb31-18"><a href="computer-practical-1.html#cb31-18" tabindex="-1"></a>    <span class="co"># Compute imbalance at this stage</span></span>
<span id="cb31-19"><a href="computer-practical-1.html#cb31-19" tabindex="-1"></a>    alloc_to_n <span class="ot">=</span> alloc[<span class="dv">1</span><span class="sc">:</span>i]</span>
<span id="cb31-20"><a href="computer-practical-1.html#cb31-20" tabindex="-1"></a>    Dn <span class="ot">=</span> <span class="fu">sum</span>(alloc_to_n<span class="sc">==</span>levels[<span class="dv">1</span>]) <span class="sc">-</span> <span class="fu">sum</span>(alloc_to_n <span class="sc">==</span> levels[<span class="dv">2</span>])</span>
<span id="cb31-21"><a href="computer-practical-1.html#cb31-21" tabindex="-1"></a>  }</span>
<span id="cb31-22"><a href="computer-practical-1.html#cb31-22" tabindex="-1"></a>  data<span class="sc">$</span>treat <span class="ot">=</span> <span class="fu">as.factor</span>(alloc)</span>
<span id="cb31-23"><a href="computer-practical-1.html#cb31-23" tabindex="-1"></a>  data</span>
<span id="cb31-24"><a href="computer-practical-1.html#cb31-24" tabindex="-1"></a>}</span></code></pre></div>
<div class="exercise">
<p><span id="exr:unlabeled-div-30" class="exercise"><strong>Exercise A.6  </strong></span>Use the function <code>biased_coin</code> above to allocate patients to the two groups. Produce the demographic table. Try this for some different values of <code>p</code>.</p>
</div>
<details>
<summary>
Click for solution
</summary>
<p>To create a biased coin design with <span class="math inline">\(p=0.9\)</span> (for example), we enter</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="computer-practical-1.html#cb32-1" tabindex="-1"></a>lg_bc1 <span class="ot">=</span> <span class="fu">biased_coin</span>(</span>
<span id="cb32-2"><a href="computer-practical-1.html#cb32-2" tabindex="-1"></a>  <span class="at">data=</span>lg_df[,<span class="sc">-</span><span class="dv">8</span>],</span>
<span id="cb32-3"><a href="computer-practical-1.html#cb32-3" tabindex="-1"></a>  <span class="at">p=</span><span class="fl">0.9</span></span>
<span id="cb32-4"><a href="computer-practical-1.html#cb32-4" tabindex="-1"></a>)</span></code></pre></div>
<p>and to produce a balance table:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="computer-practical-1.html#cb33-1" tabindex="-1"></a><span class="fu">randbalance</span>(</span>
<span id="cb33-2"><a href="computer-practical-1.html#cb33-2" tabindex="-1"></a>  <span class="at">trt =</span> lg_bc1<span class="sc">$</span>treat, </span>
<span id="cb33-3"><a href="computer-practical-1.html#cb33-3" tabindex="-1"></a>  <span class="at">covmat =</span> lg_bc1[,<span class="sc">-</span><span class="dv">8</span>], </span>
<span id="cb33-4"><a href="computer-practical-1.html#cb33-4" tabindex="-1"></a>  <span class="at">ntrt=</span><span class="dv">2</span>, </span>
<span id="cb33-5"><a href="computer-practical-1.html#cb33-5" tabindex="-1"></a>  <span class="at">trtseq =</span> <span class="fu">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;C&quot;</span>))</span></code></pre></div>
</details>
</div>
<div id="urn-designs" class="section level4 hasAnchor" number="5.1.2.4">
<h4><span class="header-section-number">A.1.2.4</span> Urn designs<a href="computer-practical-1.html#urn-designs" class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
</div>
<div id="stratifying-the-dataset" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">A.1.3</span> Stratifying the dataset<a href="computer-practical-1.html#stratifying-the-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first way we thought about to account for baseline measurements was to use stratified sampling. For this, we split the dataset into a number of strata, within each of which the participants have the same levels of the stratifying factors. For example, in some hypothetical dataste one stratum might contain only women, aged 50-65, with a history of smoking.</p>
<p>Once we have stratified the dataset, we can apply any of the methods above by simply treating the different strata as separate ‘mini-trials’.</p>
<p>In our Licorice example there are too many possible strata to do this for all levels, so we will choose just a couple. For example,</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="computer-practical-1.html#cb34-1" tabindex="-1"></a><span class="co"># Add an ID variable so that we can keep track of the order of participants</span></span>
<span id="cb34-2"><a href="computer-practical-1.html#cb34-2" tabindex="-1"></a>lg_df<span class="sc">$</span>ID <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(lg_df)</span>
<span id="cb34-3"><a href="computer-practical-1.html#cb34-3" tabindex="-1"></a><span class="co"># split the data frame according to levels of factors</span></span>
<span id="cb34-4"><a href="computer-practical-1.html#cb34-4" tabindex="-1"></a>strat_gen_sm <span class="ot">&lt;-</span> lg_df <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="computer-practical-1.html#cb34-5" tabindex="-1"></a>  <span class="fu">group_split</span>(preOp_gender, preOp_smoking) </span></code></pre></div>
<p>will create a list of data frames, one for each combination of <code>preOp_gender</code> and <code>preOp_smoking</code>. In this case there are six data frames, and for example the first (accessed by <code>strat_gen_sm[[1]]</code> contains all participants with <code>preOp_gender</code>=0 and <code>preOp_smoking</code>=1. You can choose different factors to stratify by if you want to!</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-31" class="exercise"><strong>Exercise A.7  </strong></span>Split your group using the code above, choosing two factors to stratify by. How many participants are in each strata?</p>
</div>
<details>
<summary>
Click for solution
</summary>
<p>We’ll stick with the group as above. To find the numbers of participants in each group we do</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="computer-practical-1.html#cb35-1" tabindex="-1"></a>group_sizes <span class="ot">=</span> <span class="fu">sapply</span>(</span>
<span id="cb35-2"><a href="computer-practical-1.html#cb35-2" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strat_gen_sm),</span>
<span id="cb35-3"><a href="computer-practical-1.html#cb35-3" tabindex="-1"></a>  <span class="cf">function</span>(i){</span>
<span id="cb35-4"><a href="computer-practical-1.html#cb35-4" tabindex="-1"></a>    <span class="fu">nrow</span>(strat_gen_sm[[i]])</span>
<span id="cb35-5"><a href="computer-practical-1.html#cb35-5" tabindex="-1"></a>  }</span>
<span id="cb35-6"><a href="computer-practical-1.html#cb35-6" tabindex="-1"></a>)</span>
<span id="cb35-7"><a href="computer-practical-1.html#cb35-7" tabindex="-1"></a>group_sizes</span></code></pre></div>
<pre><code>## [1] 63 47 32 27 25 41</code></pre>
</details>
<div class="exercise">
<p><span id="exr:unlabeled-div-32" class="exercise"><strong>Exercise A.8  </strong></span>Choose a couple of methods from Section <a href="computer-practical-1.html#allocmethods">A.1.2</a>, and use them with your stratified dataset.</p>
</div>
<details>
<summary>
Click for solution
</summary>
<p>The code for this will vary, but the basic idea is to work through the individual data sets individually, and apply the functions from Section <a href="computer-practical-1.html#allocmethods">A.1.2</a>. One way to do this is by creating a for loop. The code below shows how this would work for simple random sampling, but you can change the function to use whichever method you prefer.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="computer-practical-1.html#cb37-1" tabindex="-1"></a><span class="co"># This command creates an empty list, which we will fill with allocation data frames as we go through</span></span>
<span id="cb37-2"><a href="computer-practical-1.html#cb37-2" tabindex="-1"></a>alloc_list <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb37-3"><a href="computer-practical-1.html#cb37-3" tabindex="-1"></a><span class="co"># The loop works through the stratified data frames, applies SRS to allocate patients</span></span>
<span id="cb37-4"><a href="computer-practical-1.html#cb37-4" tabindex="-1"></a><span class="co"># and stores them in alloc_list</span></span>
<span id="cb37-5"><a href="computer-practical-1.html#cb37-5" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strat_gen_sm)){</span>
<span id="cb37-6"><a href="computer-practical-1.html#cb37-6" tabindex="-1"></a>  alloc_list[[i]] <span class="ot">=</span> <span class="fu">srs</span>(strat_gen_sm[[i]])</span>
<span id="cb37-7"><a href="computer-practical-1.html#cb37-7" tabindex="-1"></a>}</span>
<span id="cb37-8"><a href="computer-practical-1.html#cb37-8" tabindex="-1"></a><span class="co"># bind all the data frames back together again</span></span>
<span id="cb37-9"><a href="computer-practical-1.html#cb37-9" tabindex="-1"></a>alloc_full<span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(alloc_list)</span>
<span id="cb37-10"><a href="computer-practical-1.html#cb37-10" tabindex="-1"></a><span class="co"># re-order according to ID variable</span></span>
<span id="cb37-11"><a href="computer-practical-1.html#cb37-11" tabindex="-1"></a>alloc_full[<span class="fu">order</span>(alloc_full<span class="sc">$</span>ID),]</span></code></pre></div>
<pre><code>## # A tibble: 235 × 9
##    preOp_gender preOp_asa preOp_mallampati preOp_smoking preOp_pain age      BMI    treat    ID
##    &lt;fct&gt;        &lt;fct&gt;     &lt;fct&gt;            &lt;fct&gt;         &lt;fct&gt;      &lt;fct&gt;    &lt;fct&gt;  &lt;fct&gt; &lt;int&gt;
##  1 0            3         2                1             0          50 to 70 high   0         1
##  2 0            2         2                2             0          70 plus  medium 0         2
##  3 0            2         2                1             0          50 to 70 high   1         3
##  4 0            2         2                1             0          50 to 70 high   1         4
##  5 0            1         1                2             0          70 plus  high   0         5
##  6 0            2         3                1             0          50 to 70 high   0         6
##  7 0            3         1                1             0          50 to 70 high   0         7
##  8 0            2         2                1             0          50 to 70 high   1         8
##  9 0            3         1                1             0          70 plus  medium 1         9
## 10 0            3         2                3             0          50 to 70 high   0        10
## # ℹ 225 more rows</code></pre>
<p>It would be silly to do this with SRS - why?</p>
</details>
</div>
<div id="minimisation" class="section level3 hasAnchor" number="5.1.4">
<h3><span class="header-section-number">A.1.4</span> Minimisation<a href="computer-practical-1.html#minimisation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If we want to try to achieve balance for all prognostic factors, minimisation is a more suitable method. The function <code>Minirand</code> in the package <code>Minirand</code> implements the minimisation algorithm.</p>
<p>Much like we did in lectures, the function <code>Minirand</code> works from the point of view of having already allocated <span class="math inline">\(j-1\)</span> particpants, and being presented with a <span class="math inline">\(j^{th}\)</span>.</p>
<p>This example code is copied from the function’s help file, but with some extra comments to help you to follow it. It first creates a participant data frame, then allocates the particpants to treatment groups using Minimisation.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="computer-practical-1.html#cb39-1" tabindex="-1"></a><span class="do">## Information about the treatment</span></span>
<span id="cb39-2"><a href="computer-practical-1.html#cb39-2" tabindex="-1"></a>ntrt <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co"># There will three treatment groups</span></span>
<span id="cb39-3"><a href="computer-practical-1.html#cb39-3" tabindex="-1"></a>trtseq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>) <span class="co"># the treatment groups are indexed 1, 2, 3</span></span>
<span id="cb39-4"><a href="computer-practical-1.html#cb39-4" tabindex="-1"></a>ratio <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>)  <span class="co"># the treatment groups will be allocated in a 2:2:1 ratio</span></span>
<span id="cb39-5"><a href="computer-practical-1.html#cb39-5" tabindex="-1"></a></span>
<span id="cb39-6"><a href="computer-practical-1.html#cb39-6" tabindex="-1"></a><span class="do">## The next few rows generate the participant data frame</span></span>
<span id="cb39-7"><a href="computer-practical-1.html#cb39-7" tabindex="-1"></a>nsample <span class="ot">&lt;-</span> <span class="dv">120</span> <span class="co"># we will have 120 participants</span></span>
<span id="cb39-8"><a href="computer-practical-1.html#cb39-8" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">0</span>), nsample, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.6</span>)) </span>
<span id="cb39-9"><a href="computer-practical-1.html#cb39-9" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">0</span>), nsample, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.7</span>))</span>
<span id="cb39-10"><a href="computer-practical-1.html#cb39-10" tabindex="-1"></a>c3 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>), nsample, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.33</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>)) </span>
<span id="cb39-11"><a href="computer-practical-1.html#cb39-11" tabindex="-1"></a>c4 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">0</span>), nsample, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.33</span>, <span class="fl">0.67</span>)) </span>
<span id="cb39-12"><a href="computer-practical-1.html#cb39-12" tabindex="-1"></a>covmat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(c1, c2, c3, c4) <span class="co"># generate the matrix of covariate factors for the subjects</span></span>
<span id="cb39-13"><a href="computer-practical-1.html#cb39-13" tabindex="-1"></a><span class="co"># label of the covariates </span></span>
<span id="cb39-14"><a href="computer-practical-1.html#cb39-14" tabindex="-1"></a><span class="fu">colnames</span>(covmat) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Gender&quot;</span>, <span class="st">&quot;Age&quot;</span>, <span class="st">&quot;Hypertension&quot;</span>, <span class="st">&quot;Use of Antibiotics&quot;</span>) </span>
<span id="cb39-15"><a href="computer-practical-1.html#cb39-15" tabindex="-1"></a>covwt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="co"># equal weights/importance applied to each factor</span></span>
<span id="cb39-16"><a href="computer-practical-1.html#cb39-16" tabindex="-1"></a></span>
<span id="cb39-17"><a href="computer-practical-1.html#cb39-17" tabindex="-1"></a><span class="do">## Applying the algorithm - start here if you already have participant data!</span></span>
<span id="cb39-18"><a href="computer-practical-1.html#cb39-18" tabindex="-1"></a></span>
<span id="cb39-19"><a href="computer-practical-1.html#cb39-19" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, nsample) <span class="co"># Generate a vector to store the results (the allocations)</span></span>
<span id="cb39-20"><a href="computer-practical-1.html#cb39-20" tabindex="-1"></a><span class="co"># generate treatment assignment for the 1st subject</span></span>
<span id="cb39-21"><a href="computer-practical-1.html#cb39-21" tabindex="-1"></a>res[<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">sample</span>(trtseq, <span class="dv">1</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> ratio<span class="sc">/</span><span class="fu">sum</span>(ratio)) </span>
<span id="cb39-22"><a href="computer-practical-1.html#cb39-22" tabindex="-1"></a><span class="co"># work through the remaining patients sequentially</span></span>
<span id="cb39-23"><a href="computer-practical-1.html#cb39-23" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>nsample)</span>
<span id="cb39-24"><a href="computer-practical-1.html#cb39-24" tabindex="-1"></a>  {</span>
<span id="cb39-25"><a href="computer-practical-1.html#cb39-25" tabindex="-1"></a>  <span class="co"># get treatment assignment sequentially for all subjects</span></span>
<span id="cb39-26"><a href="computer-practical-1.html#cb39-26" tabindex="-1"></a>  <span class="co"># The vector res is updated and so all previous allocations are accounted for</span></span>
<span id="cb39-27"><a href="computer-practical-1.html#cb39-27" tabindex="-1"></a>  <span class="co"># covmat is the data frame of participant data</span></span>
<span id="cb39-28"><a href="computer-practical-1.html#cb39-28" tabindex="-1"></a>    res[j] <span class="ot">&lt;-</span> <span class="fu">Minirand</span>(</span>
<span id="cb39-29"><a href="computer-practical-1.html#cb39-29" tabindex="-1"></a>      <span class="at">covmat=</span>covmat, j, <span class="at">covwt=</span>covwt, <span class="at">ratio=</span>ratio, <span class="at">ntrt=</span>ntrt, <span class="at">trtseq=</span>trtseq, <span class="at">method=</span><span class="st">&quot;Range&quot;</span>, <span class="at">result=</span>res, <span class="at">p =</span> <span class="fl">0.9</span></span>
<span id="cb39-30"><a href="computer-practical-1.html#cb39-30" tabindex="-1"></a>      )</span>
<span id="cb39-31"><a href="computer-practical-1.html#cb39-31" tabindex="-1"></a>}</span>
<span id="cb39-32"><a href="computer-practical-1.html#cb39-32" tabindex="-1"></a><span class="do">## Store the allocation vector &#39;res&#39; as &#39;trt1&#39;</span></span>
<span id="cb39-33"><a href="computer-practical-1.html#cb39-33" tabindex="-1"></a>trt1 <span class="ot">&lt;-</span> res</span>
<span id="cb39-34"><a href="computer-practical-1.html#cb39-34" tabindex="-1"></a></span>
<span id="cb39-35"><a href="computer-practical-1.html#cb39-35" tabindex="-1"></a><span class="co"># Display the number of randomized subjects at covariate factors</span></span>
<span id="cb39-36"><a href="computer-practical-1.html#cb39-36" tabindex="-1"></a>balance1 <span class="ot">&lt;-</span> <span class="fu">randbalance</span>(trt1, covmat, ntrt, trtseq) </span>
<span id="cb39-37"><a href="computer-practical-1.html#cb39-37" tabindex="-1"></a>balance1</span></code></pre></div>
<pre><code>## $Gender
##    
## trt  0  1
##   1 30 18
##   2 31 17
##   3 15  9
## 
## $Age
##    
## trt  0  1
##   1 31 17
##   2 30 18
##   3 16  8
## 
## $Hypertension
##    
## trt  0  1  2
##   1 24  9 15
##   2 25  9 14
##   3 12  6  6
## 
## $`Use of Antibiotics`
##    
## trt  0  1
##   1 30 18
##   2 32 16
##   3 15  9</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="computer-practical-1.html#cb41-1" tabindex="-1"></a><span class="co"># Calculate the total imbalance of the allocation</span></span>
<span id="cb41-2"><a href="computer-practical-1.html#cb41-2" tabindex="-1"></a><span class="fu">totimbal</span>(<span class="at">trt =</span> trt1, <span class="at">covmat =</span> covmat, <span class="at">covwt =</span> covwt, </span>
<span id="cb41-3"><a href="computer-practical-1.html#cb41-3" tabindex="-1"></a><span class="at">ratio =</span> ratio, <span class="at">ntrt =</span> ntrt, <span class="at">trtseq =</span> trtseq, <span class="at">method =</span> <span class="st">&quot;Range&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 2.125</code></pre>
<div class="exercise">
<p><span id="exr:unlabeled-div-33" class="exercise"><strong>Exercise A.9  </strong></span>Adapt the code above to apply the minimisation algorithm to the licorice gargle data.</p>
</div>
<p>For the licorice dataset, <span class="citation">Ruetzler et al. (<a href="#ref-ruetzler2013randomized">2013</a>)</span> say that “Randomization (1:1) to licorice or placebo was assigned by a Web-based system that was accessed just before treatment by an independent researcher who was not involved in data collection; no stratification was used.”</p>
</div>
</div>
<div id="cp1analysis" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">A.2</span> Analysis<a href="computer-practical-1.html#cp1analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For our analysis section, we will work with real datasets.</p>

<div id="refs" class="references csl-bib-body hanging-indent">
<div class="csl-entry">
Altman, Douglas G. 1990. <em>Practical Statistics for Medical Research</em>. CRC press.
</div>
<div class="csl-entry">
Altman, Douglas G, and J Martin Bland. 1999. <span>“Treatment Allocation in Controlled Trials: Why Randomise?”</span> <em>Bmj</em> 318 (7192): 1209–9.
</div>
<div class="csl-entry">
Cottingham, Marci D, and Jill A Fisher. 2022. <span>“Gendered Logics of Biomedical Research: Women in US Phase i Clinical Trials.”</span> <em>Social Problems</em> 69 (2): 492–509.
</div>
<div class="csl-entry">
Efron, Bradley. 1971. <span>“Forcing a Sequential Experiment to Be Balanced.”</span> <em>Biometrika</em> 58 (3): 403–17.
</div>
<div class="csl-entry">
Fentiman, Ian S, Robert D Rubens, and John L Hayward. 1983. <span>“Control of Pleural Effusions in Patients with Breast Cancer a Randomized Trial.”</span> <em>Cancer</em> 52 (4): 737–39.
</div>
<div class="csl-entry">
Freedman, LS, and Susan J White. 1976. <span>“On the Use of Pocock and Simon’s Method for Balancing Treatment Numbers over Prognostic Factors in the Controlled Clinical Trial.”</span> <em>Biometrics</em>, 691–94.
</div>
<div class="csl-entry">
Hayes, Richard J, and Lawrence H Moulton. 2017. <em>Cluster Randomised Trials</em>. CRC press.
</div>
<div class="csl-entry">
Health, National Institute of. 2023. <span>“History of Women’s Participation in Clinical Research.”</span> Office of Research on Women’s Health. https://orwh. od. nih. gov/toolkit …. <a href="https://orwh.od.nih.gov/toolkit/recruitment/history">https://orwh.od.nih.gov/toolkit/recruitment/history</a>.
</div>
<div class="csl-entry">
Hjalmas, Hanson, and Kruse Hellstrom. 1998. <span>“Long‐term Treatment with Desmopressin in Children with Primary Monosymptomatic Nocturnal Enuresis: An Open Multicentre Study.”</span> <em>British Journal of Urology</em>.
</div>
<div class="csl-entry">
Hommel, EHEBMJ, Hans-Henrik Parving, Elisabeth Mathiesen, Berit Edsberg, M Damkjaer Nielsen, and Jørn Giese. 1986. <span>“Effect of Captopril on Kidney Function in Insulin-Dependent Diabetic Patients with Nephropathy.”</span> <em>Br Med J (Clin Res Ed)</em> 293 (6545): 467–70.
</div>
<div class="csl-entry">
Hulley, Stephen B, Steven R. Cummings, Warren S. Browner, Deborah G. Grady, and Thomas B. Newman. 2013. <em>Designing Clinical Research, Fourth Edition</em>. Lippincott Williams &amp; Wilkins.
</div>
<div class="csl-entry">
Kallis, P, JA Tooze, S Talbot, D Cowans, DH Bevan, and T Treasure. 1994. <span>“Pre-Operative Aspirin Decreases Platelet Aggregation and Increases Post-Operative Blood Loss–a Prospective, Randomised, Placebo Controlled, Double-Blind Clinical Trial in 100 Patients with Chronic Stable Angina.”</span> <em>European Journal of Cardio-Thoracic Surgery: Official Journal of the European Association for Cardio-Thoracic Surgery</em> 8 (8): 404–9.
</div>
<div class="csl-entry">
Kar, Sumit, Ajay Krishnan, Preetha K, and Atul Mohankar. 2012. <span>“A Review of Antihistamines Used During Pregnancy.”</span> <em>Journal of Pharmacology and Pharmacotherapeutics</em> 3 (2): 105–8.
</div>
<div class="csl-entry">
Kassambara, Alboukadel. 2019. <em>Datarium: Data Bank for Statistical Analysis and Visualization</em>. <a href="https://CRAN.R-project.org/package=datarium">https://CRAN.R-project.org/package=datarium</a>.
</div>
<div class="csl-entry">
Matthews, John NS. 2006. <em>Introduction to Randomized Controlled Clinical Trials</em>. CRC Press.
</div>
<div class="csl-entry">
Pocock, Stuart J, and Richard Simon. 1975. <span>“Sequential Treatment Assignment with Balancing for Prognostic Factors in the Controlled Clinical Trial.”</span> <em>Biometrics</em>, 103–15.
</div>
<div class="csl-entry">
Ruetzler, Kurt, Michael Fleck, Sabine Nabecker, Kristina Pinter, Gordian Landskron, Andrea Lassnigg, Jing You, and Daniel I Sessler. 2013. <span>“A Randomized, Double-Blind Comparison of Licorice Versus Sugar-Water Gargle for Prevention of Postoperative Sore Throat and Postextubation Coughing.”</span> <em>Anesthesia &amp; Analgesia</em> 117 (3): 614–21.
</div>
<div class="csl-entry">
Taves, Donald R. 1974. <span>“Minimization: A New Method of Assigning Patients to Treatment and Control Groups.”</span> <em>Clinical Pharmacology &amp; Therapeutics</em> 15 (5): 443–53.
</div>
<div class="csl-entry">
Treasure, Tom, and Kenneth D MacRae. 1998. <span>“Minimisation: The Platinum Standard for Trials?: Randomisation Doesn’t Guarantee Similarity of Groups; Minimisation Does.”</span> <em>Bmj</em>. British Medical Journal Publishing Group.
</div>
<div class="csl-entry">
Villar, Jesús, Carlos Ferrando, Domingo Martı́nez, Alfonso Ambrós, Tomás Muñoz, Juan A Soler, Gerardo Aguilar, et al. 2020. <span>“Dexamethasone Treatment for the Acute Respiratory Distress Syndrome: A Multicentre, Randomised Controlled Trial.”</span> <em>The Lancet Respiratory Medicine</em> 8 (3): 267–76.
</div>
<div class="csl-entry">
Vitale, Cristiana, Massimo Fini, Ilaria Spoletini, Mitja Lainscak, Petar Seferovic, and Giuseppe MC Rosano. 2017. <span>“Under-Representation of Elderly and Women in Clinical Trials.”</span> <em>International Journal of Cardiology</em> 232: 216–21.
</div>
<div class="csl-entry">
Wei, LJ. 1978. <span>“An Application of an Urn Model to the Design of Sequential Controlled Clinical Trials.”</span> <em>Journal of the American Statistical Association</em> 73 (363): 559–63.
</div>
<div class="csl-entry">
Zhong, Baoliang. 2009. <span>“How to Calculate Sample Size in Randomized Controlled Trial?”</span> <em>Journal of Thoracic Disease</em> 1 (1): 51.
</div>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-efron1971forcing" class="csl-entry">
Efron, Bradley. 1971. <span>“Forcing a Sequential Experiment to Be Balanced.”</span> <em>Biometrika</em> 58 (3): 403–17.
</div>
<div id="ref-ruetzler2013randomized" class="csl-entry">
Ruetzler, Kurt, Michael Fleck, Sabine Nabecker, Kristina Pinter, Gordian Landskron, Andrea Lassnigg, Jing You, and Daniel I Sessler. 2013. <span>“A Randomized, Double-Blind Comparison of Licorice Versus Sugar-Water Gargle for Prevention of Postoperative Sore Throat and Postextubation Coughing.”</span> <em>Anesthesia &amp; Analgesia</em> 117 (3): 614–21.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="references.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["CT4H_notes.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"bookdown": null
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
