<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Allocation | Clinical Trials 4H</title>
  <meta name="description" content="These notes mirror what we’ll follow in lectures for Clinical Trials 4H. If you have any questions or notice any errors, please email me (Rachel Oughton)." />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Allocation | Clinical Trials 4H" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="These notes mirror what we’ll follow in lectures for Clinical Trials 4H. If you have any questions or notice any errors, please email me (Rachel Oughton)." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Allocation | Clinical Trials 4H" />
  
  <meta name="twitter:description" content="These notes mirror what we’ll follow in lectures for Clinical Trials 4H. If you have any questions or notice any errors, please email me (Rachel Oughton)." />
  

<meta name="author" content="Rachel Oughton" />


<meta name="date" content="2023-11-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="bias.html"/>
<link rel="next" href="working-with-survival-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Course Information</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#lectures"><i class="fa fa-check"></i>Lectures</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#computer-classes"><i class="fa fa-check"></i>Computer classes</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#assessment"><i class="fa fa-check"></i>Assessment</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#books"><i class="fa fa-check"></i>Books</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="rct-intro.html"><a href="rct-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to Clinical Trials</a>
<ul>
<li class="chapter" data-level="1.1" data-path="rct-intro.html"><a href="rct-intro.html#a-brief-history-of-rcts"><i class="fa fa-check"></i><b>1.1</b> A brief history of RCTs</a></li>
<li class="chapter" data-level="1.2" data-path="rct-intro.html"><a href="rct-intro.html#the-structure-of-a-clinical-trial"><i class="fa fa-check"></i><b>1.2</b> The structure of a clinical trial</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="rct-intro.html"><a href="rct-intro.html#primout"><i class="fa fa-check"></i><b>1.2.1</b> The primary outcome</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rct-plan.html"><a href="rct-plan.html"><i class="fa fa-check"></i><b>2</b> Designing and planning a randomised controlled trial (RCT)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rct-plan.html"><a href="rct-plan.html#ss-norm"><i class="fa fa-check"></i><b>2.1</b> Sample size for a normally distributed primary outcome variable</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="rct-plan.html"><a href="rct-plan.html#the-treatment-effect"><i class="fa fa-check"></i><b>2.1.1</b> The treatment effect</a></li>
<li class="chapter" data-level="2.1.2" data-path="rct-plan.html"><a href="rct-plan.html#reminder-hypothesis-tests-with-a-focus-on-rcts"><i class="fa fa-check"></i><b>2.1.2</b> Reminder: hypothesis tests (with a focus on RCTs)</a></li>
<li class="chapter" data-level="2.1.3" data-path="rct-plan.html"><a href="rct-plan.html#sec-measDcont"><i class="fa fa-check"></i><b>2.1.3</b> Constructing a measure of effect size</a></li>
<li class="chapter" data-level="2.1.4" data-path="rct-plan.html"><a href="rct-plan.html#sec-power"><i class="fa fa-check"></i><b>2.1.4</b> Power: If <span class="math inline">\(H_0\)</span> is false</a></li>
<li class="chapter" data-level="2.1.5" data-path="rct-plan.html"><a href="rct-plan.html#sec-ssformulacont"><i class="fa fa-check"></i><b>2.1.5</b> A sample size formula</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="rct-plan.html"><a href="rct-plan.html#sample-size-by-simulation"><i class="fa fa-check"></i><b>2.2</b> Sample size by simulation</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="rct-plan.html"><a href="rct-plan.html#the-simulation-method"><i class="fa fa-check"></i><b>2.2.1</b> The simulation method</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bias.html"><a href="bias.html"><i class="fa fa-check"></i><b>3</b> Bias</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bias.html"><a href="bias.html#where-does-bias-come-from"><i class="fa fa-check"></i><b>3.1</b> Where does bias come from?</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="bias.html"><a href="bias.html#selection-bias"><i class="fa fa-check"></i><b>3.1.1</b> Selection bias</a></li>
<li class="chapter" data-level="3.1.2" data-path="bias.html"><a href="bias.html#allocation-bias"><i class="fa fa-check"></i><b>3.1.2</b> Allocation bias</a></li>
<li class="chapter" data-level="3.1.3" data-path="bias.html"><a href="bias.html#assessment-bias"><i class="fa fa-check"></i><b>3.1.3</b> Assessment bias</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sec-allocation.html"><a href="sec-allocation.html"><i class="fa fa-check"></i><b>4</b> Allocation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sec-allocation.html"><a href="sec-allocation.html#allocation-methods"><i class="fa fa-check"></i><b>4.1</b> Allocation methods</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="sec-allocation.html"><a href="sec-allocation.html#simple-random-allocation"><i class="fa fa-check"></i><b>4.1.1</b> Simple random allocation</a></li>
<li class="chapter" data-level="4.1.2" data-path="sec-allocation.html"><a href="sec-allocation.html#random-permuted-blocks"><i class="fa fa-check"></i><b>4.1.2</b> Random permuted blocks</a></li>
<li class="chapter" data-level="4.1.3" data-path="sec-allocation.html"><a href="sec-allocation.html#the-delta-method"><i class="fa fa-check"></i><b>4.1.3</b> The Delta Method</a></li>
<li class="chapter" data-level="4.1.4" data-path="sec-allocation.html"><a href="sec-allocation.html#a-sample-size-formula"><i class="fa fa-check"></i><b>4.1.4</b> A sample size formula</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="sec-allocation.html"><a href="sec-allocation.html#point-estimates-and-hypothesis-tests"><i class="fa fa-check"></i><b>4.2</b> Point estimates and Hypothesis tests</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="sec-allocation.html"><a href="sec-allocation.html#an-alternative-approach-chi-squared"><i class="fa fa-check"></i><b>4.2.1</b> An alternative approach: chi-squared</a></li>
<li class="chapter" data-level="4.2.2" data-path="sec-allocation.html"><a href="sec-allocation.html#likelihood-a-more-rigorous-way"><i class="fa fa-check"></i><b>4.2.2</b> Likelihood: A more rigorous way</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="sec-allocation.html"><a href="sec-allocation.html#measures-of-difference-for-binary-data"><i class="fa fa-check"></i><b>4.3</b> Measures of difference for binary data</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="sec-allocation.html"><a href="sec-allocation.html#absolute-risk-difference-and-number-needed-to-treat"><i class="fa fa-check"></i><b>4.3.1</b> Absolute risk difference and Number Needed to Treat</a></li>
<li class="chapter" data-level="4.3.2" data-path="sec-allocation.html"><a href="sec-allocation.html#risk-ratio-rr"><i class="fa fa-check"></i><b>4.3.2</b> Risk Ratio (RR)</a></li>
<li class="chapter" data-level="4.3.3" data-path="sec-allocation.html"><a href="sec-allocation.html#odds-ratio-or"><i class="fa fa-check"></i><b>4.3.3</b> Odds ratio (OR)</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="sec-allocation.html"><a href="sec-allocation.html#accounting-for-covariates-logistic-regression"><i class="fa fa-check"></i><b>4.4</b> Accounting for covariates: logistic regression</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="working-with-survival-data.html"><a href="working-with-survival-data.html"><i class="fa fa-check"></i><b>5</b> Working with survival data</a></li>
<li class="chapter" data-level="6" data-path="cluster-rct.html"><a href="cluster-rct.html"><i class="fa fa-check"></i><b>6</b> Cluster randomised controlled trials</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cluster-rct.html"><a href="cluster-rct.html#what-is-a-cluster-rct"><i class="fa fa-check"></i><b>6.1</b> What is a cluster RCT?</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="cluster-rct.html"><a href="cluster-rct.html#intracluster-correlation"><i class="fa fa-check"></i><b>6.1.1</b> Intracluster correlation</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="cluster-rct.html"><a href="cluster-rct.html#designing-a-cluster-rct"><i class="fa fa-check"></i><b>6.2</b> Designing a cluster RCT</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="cluster-rct.html"><a href="cluster-rct.html#sample-size"><i class="fa fa-check"></i><b>6.2.1</b> Sample size</a></li>
<li class="chapter" data-level="6.2.2" data-path="cluster-rct.html"><a href="cluster-rct.html#allocation"><i class="fa fa-check"></i><b>6.2.2</b> Allocation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="cluster-rct.html"><a href="cluster-rct.html#allocating-everyone-at-once"><i class="fa fa-check"></i><b>6.3</b> Allocating everyone at once</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="cluster-rct.html"><a href="cluster-rct.html#restricted-randomization"><i class="fa fa-check"></i><b>6.3.1</b> Restricted randomization</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="cluster-rct.html"><a href="cluster-rct.html#analysing-a-cluster-rct"><i class="fa fa-check"></i><b>6.4</b> Analysing a cluster RCT</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="cluster-rct.html"><a href="cluster-rct.html#at-the-cluster-level"><i class="fa fa-check"></i><b>6.4.1</b> At the cluster level</a></li>
<li class="chapter" data-level="6.4.2" data-path="cluster-rct.html"><a href="cluster-rct.html#at-the-individual-level"><i class="fa fa-check"></i><b>6.4.2</b> At the individual level</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rcts---a-bayesian-approach.html"><a href="rcts---a-bayesian-approach.html"><i class="fa fa-check"></i><b>7</b> RCTs - a Bayesian approach</a>
<ul>
<li class="chapter" data-level="7.1" data-path="rcts---a-bayesian-approach.html"><a href="rcts---a-bayesian-approach.html#bayesian-hierarchical-models"><i class="fa fa-check"></i><b>7.1</b> Bayesian hierarchical models</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Clinical Trials 4H</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec-allocation" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Allocation<a href="sec-allocation.html#sec-allocation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Historically (and probably still, to an extent), clinical trials have not necessarily used random allocation to assign participants to groups. <span class="citation">Altman and Bland (<a href="#ref-altman1999treatment">1999b</a>)</span> gives an overview of why this has led to bias, and gives some examples. <span class="citation">Altman and Bland (<a href="#ref-altman1999randomise">1999a</a>)</span> and <span class="citation">Treasure and MacRae (<a href="#ref-treasure1998minimisation">1998</a>)</span></p>
<p>Sometimes analyses compare groups in serial, so that <span class="math inline">\(N_A\)</span> patients one year (say) form the control group, and <span class="math inline">\(n_B\)</span> patients in a subsequent year, who are given treatment <span class="math inline">\(B\)</span>, form the intervention group. In this scenario it is impossible to control for all other changes that have occurred with time, and this leads to a systematic bias, usually in favour of treatment <span class="math inline">\(B\)</span>.</p>
<p>Given the need for contemporary control participants, the question becomes how to assign participants to each group. If the clinician is able to choose who receives which treatment, or if each patient is allowed to choose or refuse certain treatments, this is almost certain to introduce bias. This is avoided by using random allocation.</p>
<p>There are two important aspects to the allocation being <em>random</em> that we will draw attention to.</p>
<ol style="list-style-type: decimal">
<li>Every patient should have the same probability of being assigned to each treatment group.</li>
<li>The treatment group for a particular patient should not be able to be predicted.</li>
</ol>
<p>Point 1 is important because, as we have already mentioned, the statistical theory we use to plan and analyse the trial is based on the groups being random samples from the population.</p>
<p>Point 2 is important to avoid biases that come through the assignment of a particular patient being known either in advance or after the fact. There are some approaches that ‘pass’ the first point, but fail at the second. As well as strict alternation (<span class="math inline">\(ABABAB\ldots\)</span>), some such methods use patient characteristics such as date of birth or first letter of surname, which is not related to the trial outcome, but which enables allocations to be predicted.</p>
<p>We will now explore some commonly used methods of allocation. We will usually assume two equally sized groups, <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>, but it is simple to generalize to three or more groups, or to unequal allocation.</p>
<div id="allocation-methods" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Allocation methods<a href="sec-allocation.html#allocation-methods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="simple-random-allocation" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Simple random allocation<a href="sec-allocation.html#simple-random-allocation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Perhaps intuitively the most simple method would be a ‘toin coss’, where each participant has a probability 0.5 of being placed in each group. As participants arrive, assignment <span class="math inline">\(A\)</span> or <span class="math inline">\(B\)</span> is generated (with equal probability). Statistically, this scheme is ideal, since it generates the random sample we need, and the assignment of each participant is statistically independent of that of all other participants. It also doesn’t require a ‘master’ randomisation; several clinicians can individually assign participants to treatment groups in parallel and the statistical properties are maintained.</p>
<p>This method is, effectively, used in many large trials, but for small trials it can be statistically problematic. The main reason for this is chance imbalance of group sizes.</p>
<p>Suppose we have two groups, <span class="math inline">\(A\)</span> of size <span class="math inline">\(N_A\)</span> and <span class="math inline">\(B\)</span> of size <span class="math inline">\(N_B\)</span>, with <span class="math inline">\(N_A + N_B = 2n\)</span>. Patients are allocated independently with equal probability, which means</p>
<p><span class="math display">\[N_A \sim \operatorname{Bi}\left(2n,\frac{1}{2}\right), \]</span>
and similar for <span class="math inline">\(N_B\)</span>. If the two groups are of unequal size, the larger will be of some size <span class="math inline">\(N_{max}\)</span> between <span class="math inline">\(n\)</span> and <span class="math inline">\(2n\)</span>, such that for <span class="math inline">\(r = n+1,\,\ldots,\,2n,\)</span></p>
<p><span class="math display">\[\begin{align*}
P\left(N_{max} = r\right) &amp; = P\left(N_A = r\right) + P\left(N_B = r\right) \\
&amp; = 2{2n \choose r}\left(\frac{1}{2}\right)^{2n}.
\end{align*}\]</span>
The probability that <span class="math inline">\(N_A = N_B = n\)</span> is</p>
<p><span class="math display">\[ P\left(N_A = N_B = n\right)= {2n \choose n}\left(\frac{1}{2}\right)^{2n}. \]</span>
These probabilities are shown in Figure <a href="sec-allocation.html#fig:srs-alloc">4.1</a>. We can see that this method leads to very unequal groups relatively easily; with <span class="math inline">\(n=15\)</span>, <span class="math inline">\(P\left(N_{max}\geq 20\right) = 0.099\)</span>, so there is around a one in ten chance that one group will be double or more the size of the other.</p>
<div class="figure"><span style="display:block;" id="fig:srs-alloc"></span>
<img src="CT4H_notes_files/figure-html/srs-alloc-1.png" alt="The probability distribution of largest group size for n=15." width="672" />
<p class="caption">
Figure 4.1: The probability distribution of largest group size for n=15.
</p>
</div>
<p>As we have seen when thinking about sample sizes in Section <a href="rct-plan.html#sec-power">2.1.4</a>, this will reduce the power <span class="math inline">\(\Psi\)</span> of the trial, since it depends on <span class="math inline">\(\lambda\left(N_A,\,N_B\right) = \sqrt{\frac{1}{N_A} + \frac{1}{N_B}}\)</span>.</p>
<p>For larger trials, this imbalance will be less pronounced, for example Figure <a href="sec-allocation.html#fig:srsalloc200">4.2</a> shows the same for <span class="math inline">\(n=200\)</span>.</p>
<div class="figure"><span style="display:block;" id="fig:srsalloc200"></span>
<img src="CT4H_notes_files/figure-html/srsalloc200-1.png" alt="The probability distribution of largest group size for n=200." width="672" />
<p class="caption">
Figure 4.2: The probability distribution of largest group size for n=200.
</p>
</div>
<p>In this case the <span class="math inline">\(P\left(N_{max} \geq 220\right)=0.051\)</span>, so the chance of highly imbalanced groups is much lower. However, we may want to achieve balance on some factor thought to be important, for example sex, age group or disease state, and in this case there may be small numbers even in a large trial.</p>
</div>
<div id="random-permuted-blocks" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Random permuted blocks<a href="sec-allocation.html#random-permuted-blocks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One commonly used method to randomly allocate participants while avoiding too much imbalance is to use <em>random permuted blocks</em> (RPBs). If the blocks have size <span class="math inline">\(m\)</span>, and there are two groups then there are <span class="math display">\[{2m\choose m},\]</span> but this method can be adapted to more than two groups and to unequal group size.</p>
<p>If we have two groups, <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>, then there are six <em>blocks</em> of length containing two <span class="math inline">\(A\)</span>s and two <span class="math inline">\(Bs\)</span></p>
<p><span class="math display" id="eq:diffexp">\[\begin{align*}
1.&amp; AABB\\
2.&amp; ABAB\\
3.&amp; ABBA\\
4.&amp; BAAB\\
5.&amp; BABA\\
6.&amp; BBAA.
\end{align}

We can also randomly generate a sequence of numbers from $\left\lbrace 1, 2, 3, 4, 5, 6 \right\rbrace$, where each number has equal probability. This sequence will correspond to a sequence in $A$ and $B$ with four times the length. In this method, each patient is equally likely to receive $A$ and $B$, but there will never be a difference of more than two between the size of the two groups.

For example, suppose the sequence begins $2,1,3,6,\ldots$. Replacing each number by its block, we have $ABAB\;AABB\;ABBA\;BBAA\;\ldots$.

One serious disadvantage of this method is that if the block size is fixed, and the doctors involved in the trial know which participants have received which treatments (which is unavoidable in cases such as surgery), then the allocation for some patients can be perfectly predicted. This is true for the fourth in every block, and for the third and fourth if the first two were the same. This means that selection bias may be a problem in more than 25% of participants, which is deemed unacceptable; indeed, it fails our second point about randomization.

#### RPBs with random block length

The issue above can be circumvented by not only randomly choosing from a selection of blocks, but also randomly choosing the length of the block. For example, there are
$$ {6 \choose 3} = 20$$
possible blocks of size 6. Instead of always selecting from the six possible 4-blocks, a sampling scheme can be as follows.

  1. A random number $X$ is drawn from $\left\lbrace 4,6\right\rbrace$ to select the block length.
  2. A second random number $Y$ is drawn from 1 to 6 (if the block length is four) or 1 to 20 (if the block length is 6).
  3. The block corresponding to $Y$ is chosen and participants assigned accordingly.
  4. If more participants are needed, go back to step 1.
  
As well as ensuring that patients are equally likely to receive treatments $A$ and $B$, and that $N_A$ and $N_B$  can never differ by more than three, this method hugely reduces the possibility of enabling selection bias. The assignment of a patient can only be perfectly predicted if the difference is three, and this happens only for two of the twenty blocks of length six.

### Biased coin designs and urn schemes

It may be that we prefer a method which achieves balance while retaining the pure stochasticity of simple random sampling. An advantage of RPBs was that once the sequence was generated, no computing power was needed. However, it is safe now to assume that any hospital pharmacy, nurse&#39;s station, GP office or other medical facility will have a computer with access to the internet (or some internal database), and therefore more sophisticated methods are available.

Biased coin designs and urn schemes both work by adjusting the probabilities of allocation according to balance of the design so far, such that a participant is less likely to be assigned to an over-represented group.

#### Biased coin designs

Suppose we are using a biased coin design for a trial to compare two treatments, $A$ and $B$. At the point where some number $n$ (not the total trial cohort) have been allocated, we can use the notation $N_A\left(n\right)$ for the number of participants allocated to treatment $A$, and $N_B\left(B\right)$ for the number of participants allocated to treatment $B$. Using these, we can denote the *imbalance* in treatment numbers as

$$ D\left(n\right) = N_A\left(n\right) - N_B\left(n\right) = 2N_A\left(n\right) - n.$$
  We use the imbalance $D\left(n\right)$ to alter the probability of allocation to each treatment in order to restore (or maintain) balance in the following way:
  
  - If $D\left(n\right)=0$, allocate patient $n+1$ to treatment $A$ with probability $\frac{1}{2}$.
- If $D\left(n\right)&lt;0$, allocate patient $n+1$ to treatment $A$ with probability $P$.
- If $D\left(n\right)&gt;0$, allocate patient $n+1$ to treatment $A$ with probability $1-P$.

where $P\in\left(\frac{1}{2}, 1\right)$.

&gt; Question: What would happen if $P=\frac{1}{2}$ or $P=1$?
  
  If, at some point in the trial, we have $\lvert D\left(n\right)\rvert = j$, for some $j&gt;0$, then we must have either

$$ \lvert D\left(n+1\right)\rvert = j+1 $$
  or
$$ \lvert D\left(n+1\right)\rvert = j-1 .$$
  Because of the way we have set up the scheme,

$$ p\big(\lvert D\left(n+1\right)\rvert = j+1\big) = 1-P $$
  and

$$ p\big(\lvert D\left(n+1\right)\rvert = j-1\big) = P.$$
  If $\lvert D\left(n\right) \rvert = 0$, ie. the scheme is in exact balance after $n$ allocations, then we must have $\lvert D\left(n\right)\rvert = 1$.

The absolute imbalances therefore form a simple random walk on the non-negative integers, with transition probabilities


$$
  \begin{aligned}
P\big(\lvert D\left(n+1\right) \rvert = 1 \mid \lvert D\left(n\right)=0\big)&amp; = 1\\
P\big(\lvert D\left(n+1\right) \rvert = j+ 1 \mid \lvert D\left(n\right)=j\big)&amp; = 1 - P\\
P\big(\lvert D\left(n+1\right) \rvert = j-1 \mid \lvert D\left(n\right)=j\big)&amp; = P
\end{aligned}
$$
  Figure \@ref(fig:biasedcoin-p2thirds) shows four realisations of this random walk with $P=0.667$. We see that sometimes the imbalance gets quite high, but in general it isn&#39;t too far from 0.

&lt;div class=&quot;figure&quot;&gt;
&lt;img src=&quot;CT4H_notes_files/figure-html/biasedcoin-p2thirds-1.png&quot; alt=&quot;Absolute imbalance for a biased-coin scheme  with $P=0.667$.&quot; width=&quot;672&quot; /&gt;
&lt;p class=&quot;caption&quot;&gt;(\#fig:biasedcoin-p2thirds)Absolute imbalance for a biased-coin scheme  with $P=0.667$.&lt;/p&gt;
&lt;/div&gt;


Figure \@ref(fig:p-nearlyhalf) shows four realisations of the random walk with $P=0.55$. Here, the imbalance is able to get very high (note the change in $y$-axis); for example in the first plot, if we stopped the trial at $n=50$ we would have 34 participants in one arm and only 16 in the other.

&lt;div class=&quot;figure&quot;&gt;
&lt;img src=&quot;CT4H_notes_files/figure-html/p-nearlyhalf-1.png&quot; alt=&quot;Absolute imbalance for a biased-coin scheme  with $P = 0.55$.&quot; width=&quot;672&quot; /&gt;
&lt;p class=&quot;caption&quot;&gt;(\#fig:p-nearlyhalf)Absolute imbalance for a biased-coin scheme  with $P = 0.55$.&lt;/p&gt;
&lt;/div&gt;

By contrast, with $P=0.9$ as in Figure \@ref(fig:p-nearlyone), there is much less imbalance. However, this brings with it greater predictability. Although allocation is always random, given some degree of imbalance (likely to be known about by those executing the trial), the probability of guessing the next allocation correctly is high (0.9). This invites the biases we have been trying to avoid, albeit in an imperfect form.

&lt;div class=&quot;figure&quot;&gt;
&lt;img src=&quot;CT4H_notes_files/figure-html/p-nearlyone-1.png&quot; alt=&quot;Absolute imbalance for a biased-coin scheme  with $P = 0.9$.&quot; width=&quot;672&quot; /&gt;
&lt;p class=&quot;caption&quot;&gt;(\#fig:p-nearlyone)Absolute imbalance for a biased-coin scheme  with $P = 0.9$.&lt;/p&gt;
&lt;/div&gt;

A big disadvantage to the biased coin scheme is that the same probability is used regardless of the size of the imbalance (assuming it isn&#39;t zero). In the next section, we introduce a method where the probability of allocating the next patient to the underrepresented treatment gets larger as the imbalance grows.

#### Urn models

*Urn models* for treatment allocation use urns in the way that you might well remember from school probability (or indeed often we had drawers of socks). In this setting, the urn starts off with a ball for each treatment, and a ball is added to the urn each time a participant is allocated. The ball is labelled according to the treatment allocation that participant **did not** receive.

To allocate the next participant, a ball is drawn from the urn. If the allocations at this point are balanced, then the participant has equal probability of being allocated to each treatment. If there is imbalance, there will be more balls labelled by the underrepresented treatment, and so the participant is more likely to be allocated to that one. The greater the imbalance, the higher the probability of reducing it.

The process described so far is a $UD\left(1,1\right)$; there is one ball for each treatment to start with, and one ball is added to the urn after each allocation. To be more general, we can assume a $UD\left(r,s\right)$ scheme. Now, there are $r$ balls for each treatment in the urn to begin with, and $s$ are added after each allocation.

Near the start of the allocation, the probabilities are likely to change a lot to address imbalance, but once a &#39;reasonable number&#39; of allocations have been made it is likely to settle into simple random sampling (or very close).

Once again, we can find the transition probabilities by considering the absolute imbalance $\lvert D\left(n\right) \rvert$.

Suppose that after participant $n$, $N_A\left(n\right)$ participants have been allocated to treatment $A$, and $N_B\left(n\right) = n - N_A\left(n\right)$ to treatment $B$. The imbalance is therefore

$$D\left(n\right) = N_A\left(n\right) - N_B\left(n\right) = 2N_A\left(n\right) - n.$$
  After $n$ allocations there will be $2r + ns$ balls in the urn: $r$ for each treatment at the start, and $s$ added after each allocation. Of these, $r + N_B\left(n\right)s$ will be labelled by treatment $A$ and $r + N_A\left(n\right)s$ by treatment $B$.

To think about the probabilities for the absolute imbalance $\lvert D\left(n\right)\rvert$, we have to be careful now about which direction it is in. If the trial currently (after allocation $n$) has an imbalance of participants in favour of treatment $A$, then the probability that it becomes less imbalanced at the next allocation is the probability of the next allocation being to treatment $B$, which is

$$
  \begin{aligned}
p\left(\lvert D\left(n+1\right)\rvert = j-1 \mid D\left(n\right)=j, j&gt;0\right) &amp; = \frac{r + N_A\left(n\right)s}{2r + ns} \\
&amp; = \frac{r + \frac{1}{2}\left(n + D\left(n\right)\right)s}{2r + ns} \\
&amp; = \frac{1}{2} + \frac{D\left(n\right)s}{2\left(2r + ns\right)} \\
&amp; = \frac{1}{2} + \frac{\lvert D\left(n\right)\rvert s}{2\left(2r + ns\right)}.
\end{aligned}
$$
  Similarly, if there is currently an excess of patients allocated to treatment $B$, then the imbalance will be reduced if the next allocation is to treatment $A$, and so the conditional probability is

$$
  \begin{aligned}
p\left(\lvert D\left(n+1\right)\rvert = j-1 \mid D\left(n\right)=j, j&lt;0\right) &amp; = \frac{r + N_B\left(n\right)s}{2r + ns} \\
&amp; = \frac{r + \frac{1}{2}\left(n - D\left(n\right)\right)s}{2r + ns} \\
&amp; = \frac{1}{2} - \frac{D\left(n\right)s}{2\left(2r + ns\right)}\\
&amp; = \frac{1}{2} + \frac{\lvert D\left(n\right)\rvert s}{2\left(2r + ns\right)}.
\end{aligned}
$$
  
  Because the process is symmetrical, an imbalance of a given magnitude (say $\lvert D\left(n\right)\rvert=j$) is equally likely to be in either direction. That is

$$p\big(D\left(n\right) &lt; 0 \mid \lvert D\left(n\right)\rvert =j \big)= p\big(D\left(n\right) &gt; 0 \mid \lvert D\left(n\right)\rvert =j \big) = \frac{1}{2}.$$
  
  Therefore we can use the law of total probability (or partition theorem) to find that

$$
  p\big(\lvert D\left(n+1\right) \rvert = j-1 \mid \lvert D\left(n\right) \rvert = j \big) = \frac{1}{2}  + \frac{\lvert D\left(n\right)\rvert s}{2\left(2r + ns\right)}.
$$
  Since the two probabilities are equal this is trivial. Since the only other possibility is that the imbalance is increased by one, we also have

$$p\big(\lvert D\left(n+1\right) \rvert = j+1 \mid \lvert D\left(n\right) \rvert = j \big) = \frac{1}{2}  - \frac{\lvert D\left(n\right)\rvert s}{2\left(2r + ns\right)}. $$
  As with the biased coin design, we also have the possibility that the imbalance after $n$ allocations is zero, in which case the absolute imbalance after the next allocation will definitely be one. This gives us another simple random walk, with

$$
  \begin{aligned}
P\big(\lvert D\left(n+1\right) \rvert = 1 \mid \lvert D\left(n\right)=0\big)&amp; = 1\\
P\big(\lvert D\left(n+1\right) \rvert = j+ 1 \mid \lvert D\left(n\right)=j\big)&amp; = \frac{1}{2}  - \frac{\lvert D\left(n\right)\rvert s}{2\left(2r + ns\right)}\\
P\big(\lvert D\left(n+1\right) \rvert = j-1 \mid \lvert D\left(n\right)=j\big)&amp; = \frac{1}{2}  + \frac{\lvert D\left(n\right)\rvert s}{2\left(2r + ns\right)}
\end{aligned}
$$
  



&lt;div class=&quot;figure&quot;&gt;
&lt;img src=&quot;CT4H_notes_files/figure-html/urn11-1.png&quot; alt=&quot;Four realisations of absolute imbalance for r=1, s=1, N=50.&quot; width=&quot;672&quot; /&gt;
&lt;p class=&quot;caption&quot;&gt;(\#fig:urn11)Four realisations of absolute imbalance for r=1, s=1, N=50.&lt;/p&gt;
&lt;/div&gt;

&lt;div class=&quot;figure&quot;&gt;
&lt;img src=&quot;CT4H_notes_files/figure-html/urn18-1.png&quot; alt=&quot;Four realisations of absolute imbalance for r=1, s=8, N=50.&quot; width=&quot;672&quot; /&gt;
&lt;p class=&quot;caption&quot;&gt;(\#fig:urn18)Four realisations of absolute imbalance for r=1, s=8, N=50.&lt;/p&gt;
&lt;/div&gt;

&lt;div class=&quot;figure&quot;&gt;
&lt;img src=&quot;CT4H_notes_files/figure-html/urn81-1.png&quot; alt=&quot;Four realisations of absolute imbalance for r=8, s=1, N=50.&quot; width=&quot;672&quot; /&gt;
&lt;p class=&quot;caption&quot;&gt;(\#fig:urn81)Four realisations of absolute imbalance for r=8, s=1, N=50.&lt;/p&gt;
&lt;/div&gt;

We see that imbalance is reduced, particularly for small $n$. A small $r$ and large $s$ enhance this, since the large number ($s$) of balls added to the urn with each allocation weight the probabilities more heavily, as in Figure \@ref(fig:urn18). By contrast, if $r$ is large and $s$ is small, as in Figure \@ref(fig:urn81), the probabilities stay closer to $\left(\frac{1}{2}, \frac{1}{2}\right)$ and so more imbalance occurs early on.


## Problems with allocation


In clinical trials papers, the allocation groups are usually summarised in tables giving summary statistics (eg. mean and SD) of each characteristic for the control group and the intervention group. The aim of these is to show that the groups are similar enough for any difference in outcome to be attributed to the intervention itself. Figure \@ref(fig:licorice-participants) shows an example.

&lt;div class=&quot;figure&quot;&gt;
&lt;img src=&quot;images/licorice.jpg&quot; alt=&quot;Summary statistics for an RCT comparing a licorice gargle (the intervention) to a sugar-water gargle (the standard). From @ruetzler2013randomized&quot; width=&quot;60%&quot; /&gt;
&lt;p class=&quot;caption&quot;&gt;(\#fig:licorice-participants)Summary statistics for an RCT comparing a licorice gargle (the intervention) to a sugar-water gargle (the standard). From @ruetzler2013randomized&lt;/p&gt;
&lt;/div&gt;

The problem here is that only the marginal distributions are compared for similarity. Consider the following (somewhat extreme and minimalistic) scenario. A study aims to investigate the effect of some treatment, and to balance for gender and age in their allocation, resulting in the following summary table.

&lt;table&gt;
&lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt; Variable &lt;/th&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt; Control (n=100) &lt;/th&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt; Intervention (n=100) &lt;/th&gt;
  &lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Gender (female, %) &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; 50 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; 50 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Age, y (mean +/- SD) &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; 50 +/- 10 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; 50 +/- 10 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

This appears to be a perfectly balanced design. However, if we look at the joint distribution, we see that there are problems.


&lt;img src=&quot;CT4H_notes_files/figure-html/unnamed-chunk-5-1.png&quot; width=&quot;672&quot; /&gt;


&lt;table&gt;
&lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt;   &lt;/th&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt; Male &lt;/th&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt; Female &lt;/th&gt;
  &lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;font-weight: bold;&quot;&gt; Control &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; 59.4 (7.37) &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; 44.02 (5.49) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;font-weight: bold;&quot;&gt; Intervention &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; 42.22 (7.2) &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; 57.84 (6.7) &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

If the intervention is particularly effective in older men, our trial will not notice. Likewise, if older women generally have a more positive outcome than older men, our trial may erroneously find the intervention to be effective.

Although this example is highly manufactured and [hopefully!] unlikely to take place in real life, for clinical trials there are often many demographic variables and prognostic factors being taken into account. Achieving joint balance across all them is very difficult, and extremely unlikely to happen if it isn&#39;t aimed for. @treasure1998minimisation give an example in relation to a hypothetical study on heart disease

&gt; Supposing one group has more elderly women with diabetes and symptoms of heart failure. It would then be impossible to attribute a better outcome in the other group to the beneficial effects of treatment since poor left ventricular function and age at outset are major determinants of survival in any longitudinal study of heart disease, and women with diabetes, as a group, are likely to do worse. At this point the primary objective of randomisation—exclusion of confounding factors—has failed. ... If a very big trial fails, because, for example, the play of chance put more hypertensive smokers in one group than the other, the tragedy for the trialists, and all involved, is even greater.


## Stratified sampling

The usual method of achieving balance with respect to prognostic factors is to divide each factor into several levels and to consider treatment assignment separately for patients having each particular combination of such factor levels. Such groups of patients are commonly referred to as randomization groups or strata. Treatment assignment is performed entirely separately for each stratum, a permuted block design of the type mentioned above often being used. In fact, using purely random treatment assignment for each stratum is equivalent to simple random assignment, so that some equalization of treatment numbers within each stratum is essential. This whole procedure is analogous to performing a factorial experiment, without being able to control the factor levels of the experimental units.

:::{.example}

Suppose we are planning a trial involving people over the age of 50, and we anticipate that age and sex might both play an important role in how participants respond to the treatment.

For sex, we use the levels &#39;male&#39; and &#39;female&#39;, and for age we split the range into 50-65, 66-80 and 81 or over. We therefore have six strata, and we use an allocation strategy independently in each stratum. For example, below we have used randomly permuted blocks of length four.

&lt;table&gt;
&lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt;   &lt;/th&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt; Male &lt;/th&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt; Female &lt;/th&gt;
  &lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;font-weight: bold;&quot;&gt; 50-65 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; ABAB BBAA ... &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; ABBA BBAA ... &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;font-weight: bold;&quot;&gt; 66-80 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; BAAB AABB ... &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; BABA BAAB ... &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;font-weight: bold;&quot;&gt; 81 and over &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; ABAB ABBA ... &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; ABBA BAAB ... &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


Each time a new participant arrives, we follow the randomization pattern for their stratum. We could use another allocation scheme within each stratum, for example an urn model or a biased coin. It is important that we use one that aims to conserve balance, or else the benefits of stratification are lost.
:::


A difficulty with stratified sampling is that the number of strata can quickly become large as the number of factors (or the number of levels within some factors) increases. For example, if we have four prognostic factors each with three levels, there are $3^4=81$ strata. This creates a situation that is at best unwieldy, and at worst completely unworkable; in a small trial (with say 100 patients in each arm) there may be some strata with no patients in (this is actually not a problem), and probably many more with only one (this is much more problematic).


## Minimization

@altman1999randomise tees up minimization.
@treasure1998minimisation a good source.

Minimization was first proposed by @taves1974minimization, then shortly after by @pocock1975sequential and @freedman1976use. The aim of minimization is to minimize the difference between the two groups. It was developed for us with strata, as an alternative to randomly permuted blocks. Although the method was developed in the seventies, it has only gained popularity relatively recently, mainly as computers have become widely available.

To form the strata, the people running the trial must first specify all of the factors they would like to be balanced between the two groups. These should be any variables that are thought to possibly affect the outcome. As an example, in a study comparing aspirin to a placebo preceding coronary artery surgery, @kallis1994pre chose age ($\leq{50}$ or $50$), sex (M or F), operating surgeon (3 possibilities) and number of coronary arteries affected (1 or 2).

When a patient enters the trial, these factors are listed. The patient is then allocated in such a way as to minimise any difference in these factors. The minimization method has evolved since its conception, and exists in several forms. Two areas in which methods vary are

  * Whether continuous variables have to be binned
  * Whether there is any randomness
  
It is generally agreed that if the risk of selection bias cannot be avoided, there should be an element of randomness. It is also usually accepted that if a variable is included in the minimization, it should also be included in the statistical analysis.

### Minimization algorithm

Suppose we have a trial in which patients are recruited sequentially and need to be allocated to a trial arm (of which there are two). @pocock1975sequential give an algorithm in the general case of $N$ treatment arms, but we will not do that here.

Suppose there are several prognostic factors over which we require balance, and that these factors have $I, J, K, ...$ levels. In our example above, there would be $I=2,\; J=2,\; K=3,\; L=2$. Note that this equates to 24 strata.

At some point in the trial, suppose we have recruited $n_{ijkl}$ patients with levels $i,\,j,\,k,\,l$ of the factors. For example, this may be males, aged over 50, assigned to the second surgeon, with both coronary arteries affected. Within these, $n^A_{ijkl}$ have been assigned to treatment arm $A$, and $n^B_{ijkl}$ to arm $B$. So we have

$$ n^A_{ijkl} + n^B_{ijkl} = n_{ijkl} .$$

If we were to use random permuted blocks within each stratum, then we would be assured that

$$\lvert n^A_{ijkl} - n^B_{ijkl} \rvert \leq{\frac{1}{2}b},$$
where $b$ is the block length. However, there are two issues with this:

  * There may be very few patients in some strata, in which case RPBs will fail to provide adequate balance.
  * It is unlikely that we actually need this level of balance.
  
The first point is a pragmatic one - the method usually guaranteed to achieve good balance is likely to fail, at least for some strata. The second is more theoretical. In general, we require that groups be balanced according to each individual prognostic factor, but not to interactions. For example, it is often believed that younger patients would have generally better outcomes, but that other factors do not systematically affect this difference.

Therefore, it is enough to make sure that the following are all small:

$$
\begin{aligned}
\lvert n^A_{i+++} - n^B_{i+++} \rvert&amp;\text{ for each }i=1,\ldots,I\\
\lvert n^A_{+j++} - n^B_{+j++} \rvert&amp;\text{ for each }j=1,\ldots,J\\
\ldots&amp;
\end{aligned}
$$
where $+$ represents summation over the other factors, so that for exammple

$$n^A_{++k+} = \sum\limits_{i,j,l}{n^A_{ijkl}}$$
is the total number of patients with level $k$ of that factor assigned to treatment arm $A$.

Therefore, instead of having $IJKL$ constraints constraints, as we would with using randomly permuted blocks within each stratum, we have $I+J+K+L$ constraints, one for each level of each factor. In our example this is 9 constraints rather than 24.

In order to implement minimisation, we follow these steps:

  1. Allocate the first patient by simple randomisation.
  2. Suppose that at some point in the trial we have recruited $n_{ijkl}$ patients with prognostic factors $i,\,j,\,k,\,l$. Of these $n^A_{ijkl}$ are allocated to treatment arm $A$ and $n^B_{ijkl}$ to arm $B$.
  3. A new patient enters the trial. They have prognostic factors at levels $w,\,x,\,y,\,z$.
  4. We form the sum
  $$\left(n^A_{w+++} - n^B_{w+++}\right) + \left(n^A_{+x++} - n^B_{+x++}\right) + \left(n^A_{++y+} - n^B_{++y+}\right) + \left(n^A_{+++z} - n^B_{+++z}\right).$$
  5. If the sum from step 4 is negative (that is, allocation to arm $B$ as dominated up to now) then we allocate the new patient to arm $A$ with probability $P$, with $P&gt;0.5$. If the sum is positive, they are allocated to arm $B$ with probability $P$. If the sum is zero, they are allocated to arm $A$ with probability \frac{1}{2}.
  
Some people set $P=1$, whereas others would set $\frac{1}{2}&lt;P&lt;1$ to retain some randomness.  Although setting $P=1$ makes the system deterministic, to predict the next allocation a doctor (or whoever) would need to know $n^A_{i+++}$ and so on. This is very unlikely unless they are deliberately seeking to disrupt the trial. However, generally the accepted approach is becoming to set $P&lt;1$.

:::{.example}

From @altman1990practical (citing @fentiman1983control).
In this trial, 46 patients with breast cancer were allocated to receive either Mustine (arm A) or Talc (arm B) as treatment for pleural effusions (fluid between the walls of the lung). They used four prognostic factors: age ($\leq{50}$ or $&gt;50$), stage of disease (I or II, III or IV), time in months between diagnosis of breast cancer and diagnosis of pleural effusions ($\leq{30}$ or $&gt;30$)  and menopausal status (Pre or post).

Let&#39;s suppose that 15 patients have already been allocated. The totals of patients in each treatment arm in terms of each level of each prognostic factor are shown in Table \@ref(tab:minim_eg).


&lt;table class=&#39;gmisc_table&#39; style=&#39;border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;&#39; &gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#39;border-top: 2px solid grey;&#39;&gt;&lt;/th&gt;
&lt;th colspan=&#39;2&#39; style=&#39;font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center; margin: 0; padding: 0; vertical-align: middle;&#39;&gt;Example after 15 allocations&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;th style=&#39;border-bottom: 1px solid grey;&#39;&gt;&lt;/th&gt;
&lt;th style=&#39;margin: 0; padding: 0; font-weight: 900; vertical-align: middle; border-bottom: 1px solid grey; text-align: center;&#39;&gt;Mustine (A)&lt;/th&gt;
&lt;th style=&#39;margin: 0; padding: 0; font-weight: 900; vertical-align: middle; border-bottom: 1px solid grey; text-align: center;&#39;&gt;Talc (B)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;&lt;td colspan=&#39;3&#39; style=&#39;margin: 0; padding: 0; font-weight: normal;&#39;&gt;Age&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: left;&#39;&gt;&amp;nbsp;&amp;nbsp;1.≤50&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;3&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: left;&#39;&gt;&amp;nbsp;&amp;nbsp;2. &gt;50&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;4&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan=&#39;3&#39; style=&#39;margin: 0; padding: 0; font-weight: normal;&#39;&gt;Stage&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: left;&#39;&gt;&amp;nbsp;&amp;nbsp;1. I or II&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;1&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: left;&#39;&gt;&amp;nbsp;&amp;nbsp;2. III or IV&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;6&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan=&#39;3&#39; style=&#39;margin: 0; padding: 0; font-weight: normal;&#39;&gt;Time interval&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: left;&#39;&gt;&amp;nbsp;&amp;nbsp;1. ≤30 months&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;4&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: left;&#39;&gt;&amp;nbsp;&amp;nbsp;2. &gt;30 months&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;4&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan=&#39;3&#39; style=&#39;margin: 0; padding: 0; font-weight: normal;&#39;&gt;Menopausal Status&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: left;&#39;&gt;&amp;nbsp;&amp;nbsp;1. Pre&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;4&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; text-align: center;&#39;&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#39;margin: 0; padding: 0; border-bottom: 2px solid grey; text-align: left;&#39;&gt;&amp;nbsp;&amp;nbsp;2. Post&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; border-bottom: 2px solid grey; text-align: center;&#39;&gt;5&lt;/td&gt;
&lt;td style=&#39;margin: 0; padding: 0; border-bottom: 2px solid grey; text-align: center;&#39;&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;tr&gt;&lt;td colspan=&#39;3&#39; style=&#39;text-align: left;&#39;&gt;
Allocations of first 15 patients, divided by diagnostic factor&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
Suppose our sixteenth patient is under 50, has is at stage III, has less than 30 months between diagnoses and is pre-menopausal.
Our calculation from step 4 of the minimisation algorithm is therefore

$$
\begin{aligned}
\left(n^A_{1+++} - n^B_{1+++}\right) + \left(n^A_{+2++} - n^B_{+2++}\right) + \left(n^A_{++1+} \right.&amp; \left.- n^B_{++1+}\right) + \left(n^A_{+++1} - n^B_{+++1}\right) \\
&amp; = \left(3-4\right) + \left(6-6\right) + \left(4-2\right) + \left(4-3\right) \\
&amp; = -1 + 0 + 2 + 1\\
&amp; = 2 .
\end{aligned}
$$
Since our sum is greater than zero, we allocate the new patient to arm B (talc) with some probability $P\in\left(0.5,1\right)$ and update the table before allocating patient 17.
:::



## Some simulated examples

To conclude this section we will demonstrate methods using simulated datasets with the same underlying probability distributions. We consider four factors:
  
  * Age: 44 and under, 45 - 54, 55-64, 65-74 and 75 and over (5 levels)
* Sex: M or F
* Smoking: current, past or never
* Hypertension: Yes or no

These will be generated using the following distributions:
  
  * Age: $N\left(60, 10^2\right)$ (then binned as above)
* Sex: $p\left(M\right)= p\left(F\right) = 0.5$
  * Smoking: $p\left(\text{Current}\right)=0.4,\,p\left(\text{Past}\right) = p\left(\text{Never}\right) = 0.3$
  * Hypertension:   
  $p(Y) = \begin{cases}
0.25  &amp; \text{Age under 45} \\
0.55 &amp; \text{Age 45 to 74}\\
0.75 &amp; \text{Age 75 and over}
\end{cases}$
  
  To demonstrate our allocation methods, we simulate one dataset from the distribution described, containing 100 participants. This dataset is shown in the Table below, and in Figures \@ref(fig:part-gen1a) and \@ref(fig:part-gen1b).


&lt;div data-pagedtable=&quot;false&quot;&gt;
  &lt;script data-pagedtable-source type=&quot;application/json&quot;&gt;
{&quot;columns&quot;:[{&quot;label&quot;:[&quot;ID&quot;],&quot;name&quot;:[1],&quot;type&quot;:[&quot;int&quot;],&quot;align&quot;:[&quot;right&quot;]},{&quot;label&quot;:[&quot;Sex&quot;],&quot;name&quot;:[2],&quot;type&quot;:[&quot;fct&quot;],&quot;align&quot;:[&quot;left&quot;]},{&quot;label&quot;:[&quot;Age&quot;],&quot;name&quot;:[3],&quot;type&quot;:[&quot;fct&quot;],&quot;align&quot;:[&quot;left&quot;]},{&quot;label&quot;:[&quot;Smoking&quot;],&quot;name&quot;:[4],&quot;type&quot;:[&quot;fct&quot;],&quot;align&quot;:[&quot;left&quot;]},{&quot;label&quot;:[&quot;Hypertension&quot;],&quot;name&quot;:[5],&quot;type&quot;:[&quot;fct&quot;],&quot;align&quot;:[&quot;left&quot;]}],&quot;data&quot;:[{&quot;1&quot;:&quot;1&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;2&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;75 and over&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;3&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;75 and over&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;4&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;5&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;6&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;75 and over&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;7&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;8&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;9&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;75 and over&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;10&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;11&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;12&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;44 and under&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;13&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;14&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;15&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;16&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;17&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;18&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;19&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;20&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;21&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;22&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;23&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;24&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;25&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;26&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;27&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;28&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;29&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;30&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;31&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;32&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;44 and under&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;33&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;34&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;35&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;36&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;37&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;38&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;39&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;40&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;41&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;42&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;75 and over&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;43&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;44&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;45&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;75 and over&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;46&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;47&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;48&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;49&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;50&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;51&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;52&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;53&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;54&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;55&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;44 and under&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;56&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;75 and over&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;57&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;58&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;59&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;60&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;61&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;62&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;63&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;64&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;65&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;66&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;75 and over&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;67&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;75 and over&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;68&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;69&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;75 and over&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;70&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;75 and over&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;71&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;72&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;73&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;75 and over&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;74&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;75&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;44 and under&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;76&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;77&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;78&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;79&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;80&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;45 to 54&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;81&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;44 and under&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;82&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;83&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;84&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;85&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;86&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;87&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;88&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;44 and under&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;89&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;75 and over&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;90&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;91&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;92&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;93&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;94&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;95&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;96&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Past&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;97&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;98&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;65 to 74&quot;,&quot;4&quot;:&quot;Never&quot;,&quot;5&quot;:&quot;Yes&quot;},{&quot;1&quot;:&quot;99&quot;,&quot;2&quot;:&quot;Male&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;},{&quot;1&quot;:&quot;100&quot;,&quot;2&quot;:&quot;Female&quot;,&quot;3&quot;:&quot;55 to 64&quot;,&quot;4&quot;:&quot;Current&quot;,&quot;5&quot;:&quot;No&quot;}],&quot;options&quot;:{&quot;columns&quot;:{&quot;min&quot;:{},&quot;max&quot;:[10]},&quot;rows&quot;:{&quot;min&quot;:[10],&quot;max&quot;:[10]},&quot;pages&quot;:{}}}
  &lt;/script&gt;
&lt;/div&gt;


&lt;div class=&quot;figure&quot;&gt;
&lt;img src=&quot;CT4H_notes_files/figure-html/part-gen1a-1.png&quot; alt=&quot;A simulated dataset of 100 participants, using the distributions described above, split by hypertension, age and sex.&quot; width=&quot;672&quot; /&gt;
&lt;p class=&quot;caption&quot;&gt;(\#fig:part-gen1a)A simulated dataset of 100 participants, using the distributions described above, split by hypertension, age and sex.&lt;/p&gt;
&lt;/div&gt;



&lt;div class=&quot;figure&quot;&gt;
&lt;img src=&quot;CT4H_notes_files/figure-html/part-gen1b-1.png&quot; alt=&quot;A simulated dataset of 100 participants, using the distributions described above, split by smoking history, age and sex.&quot; width=&quot;672&quot; /&gt;
&lt;p class=&quot;caption&quot;&gt;(\#fig:part-gen1b)A simulated dataset of 100 participants, using the distributions described above, split by smoking history, age and sex.&lt;/p&gt;
&lt;/div&gt;

### Simple random allocation

In simple random allocation, each participant is allocated to one of the two trial arms with equal probability. In terms of our allocation,




# The intervention


Having settled on a sample size and an allocation strategy, the trial can now be run.




&lt;!--chapter:end:03-allocation.Rmd--&gt;

# Analyzing RCT data {#rct-analysis}

We&#39;re now in the post-trial stage. The trial has been run, and we have lots of data to analyze to try to assess what effect the treatment or intervention has had. In general we will use the notation $\tau$ to denote the treatment effect.

We&#39;ll first focus on the scenario where the trial outcome is measured on a continuous scale, and then we&#39;ll go on to look at other types of data.

::: {.example}
To illustrate the theory and methods, we&#39;ll use an example dataset from @hommel1986effect (this example is also used by @matthews2006introduction). The data involves a trial of 16 diabetes patients, and focusses on a drug (Captopril) that may reduce blood pressure. This is important, since for those with diabetes, high blood pressure can exacerbate kidney disease (specifically diabetic nephropathy, a complication of diabetes). To participate in the trial, people had to be insulin-dependent and already affected by diabetic nephropathy. In the trial, systolic blood pressure was measured before participants were allocated to each trial arm, and then measured again after one week on treatment. A placebo was given to the control group, so that all participants were blinded.

The baseline and outcome blood pressure measurements are shown below, in mmHg. We see that nine participants were assigned to the treatment arm (Captopril) and the remaining seven to the placebo group. @hommel1986effect say that the patients were &#39;randomly allocated&#39; to their group.


&lt;table&gt;
&lt;caption&gt;(\#tab:captoprildata)Data for the Captopril trial from @hommel1986effect.&lt;/caption&gt;
&lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; Patient (ID) &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; Baseline (B) &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; Outcome at 1 week (X) &lt;/th&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt; Trial Arm &lt;/th&gt;
  &lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 1 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 147 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 137 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 2 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 129 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 120 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 3 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 158 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 141 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 4 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 164 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 137 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 5 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 134 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 140 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 6 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 155 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 144 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 7 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 151 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 134 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 8 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 141 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 123 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 9 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 153 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 142 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 1 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 133 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 139 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 2 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 129 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 134 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 3 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 152 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 136 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 4 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 161 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 151 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 5 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 154 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 147 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 6 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 141 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 137 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 7 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 156 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 149 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


This is very small dataset, and so in that respect it is quite unusual, but its structure is similar to many other trials.

:::
  
  We will build up from the simplest type of analysis to some more complicated / sophisticated approaches.

## Confidence intervals and P-values

Because the randomization process should produce groups that are comparable, we should in principle be able to compare the primary outcome (often referred to as $X$) between the groups.

::: {.example}
Summary statistics of the outcome for each group are shown below.

&lt;table&gt;
&lt;caption&gt;(\#tab:unnamed-chunk-10)Summary statistics for each group.&lt;/caption&gt;
&lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt;   &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; Sample Size &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; Mean (mmHg) &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; SD (mmHg) &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; SE of mean (mmHg) &lt;/th&gt;
  &lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 9 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 135.33 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 8.43 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 2.81 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 7 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 141.86 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 6.94 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 2.62 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

We see that the difference in mean outcome (systolic blood pressure) between the two groups is $141.86 - 135.33 = 6.53 \text{mmHg}$. Clearly overall there has been some reduction in systolic blood pressure for those in the Captopril arm, but how statistically sound is this as evidence? It could be that really (for the hypothetical population) there is no reduction, and we have just been &#39;lucky&#39;.

The variances within the two groups are fairly close, so we can use the pooled estimate of standard deviation:
  
$$
  s_p = \sqrt{\frac{\sum\limits_{i=1}^N\left(n_i-1\right)s_i^2}{\sum\limits_{i-1}^N\left(n_i-1\right)}}.
$$
  
  In our case

$$
  \begin{aligned}
s_p&amp;= \sqrt{\frac{8\times{8.43^2} + 6 \times{6.94^2}}{8+6}}\\
&amp; = 7.82\text{ mmHg.}
\end{aligned}
$$
  This enables us to do an independent two-sample $t$-test, and we can find the $t$ statistic

$$
  \begin{aligned}
t &amp; = \frac{\bar{X_1} - \bar{X_2}}{s_p\sqrt{\frac{1}{n_1} + \frac{1}{n_2}}}\\
&amp; = \frac{6.53}{7.82\sqrt{\frac{1}{9} + \frac{1}{7}}} \\
&amp; = 1.65.
\end{aligned}
$$
Note that here we are taking the placebo group to be group 1, and the Captopril group to be group 2.

  Under the null hypothesis that the mean systolic blood pressure at the end of the week of treatment/placebo is the same in both groups, this value should have a $t$ distribution with 14 degrees of freedom ($n_i-1$ for each group).

&lt;img src=&quot;CT4H_notes_files/figure-html/unnamed-chunk-11-1.png&quot; width=&quot;672&quot; /&gt;

The dashed line is at $t=1.65$, and the red shaded areas show anywhere &#39;at least as extreme&#39;. We can find the area (ie. the probability of anything at least as extreme as our found value) in R by

```r
2*(1-pt(1.65, df=14))
```

```
## [1] 0.1211902
```
This is the value we know as &#39;the P value&#39;. We see that in this case our results are not statistically significant (at the 0.10 level), under this model.
:::
  
#### What do we do with this outcome?
  
  The outcome of this Captopril study is in some ways the worst case scenario. The difference in means is large enough to be compelling, but our dataset is too small for it to be statistically significant, and so we can&#39;t confidently conclude that Captopril has any effect on blood pressure. However, we also can&#39;t say that there is no effect. This is exactly the sort of scenario we hoped to avoid when planning our study.

One way to reframe the question is to consider the range of treatment effects that are compatible with our trial data. That is, we find the set

$$\left\lbrace \tau \mid \frac{\lvert \bar{x}_1 - \bar{x}_2 - \tau \rvert}{s\sqrt{n_1^{-1} + n_2^{-1}}} \leq t_{n_1+n_2-2;\,0.975} \right\rbrace, $$
which contains all possible values of treatment effect $\tau$ that are compatible with our data. That is, suppose the true treatment effect is  $\tau^*$, and we test the hypothesis that $\tau = \tau^*$. For all values of $\tau^*$ inside this range, our data are not sufficiently unlikely to reject the hypothesis at the 0.05 level. However, for all values of $\tau^*$ outside this range, our data are sufficiently unlikely to reject that hypothesis. We can rearrange this to give a 95% confidence interval for $\tau$,

$$\left\lbrace \tau \mid \bar{x}_1 - \bar{x}_2 - t_{n_1+n_2-2;\,0.975}\,s\sqrt{n_1^{-1} + n_2^{-1}} \leq \tau \leq \bar{x}_1 - \bar{x}_2 + t_{n_1+n_2-2;\,0.975}\,s\sqrt{n_1^{-1} + n_2^{-1}}  \right\rbrace $$

::: {.example}

Continuing our example, we have

$$\left\lbrace \tau \mid \frac{\lvert 6.53 - \tau \rvert}{7.82\sqrt{\frac{1}{7} + \frac{1}{9}}} \leq t_{14;0.975} = 2.145 \right\rbrace $$
  
  Here, $t_{14;0.975} = 2.145$ is the $t$-value for a significance level of $0.05$, so if we were working to a different significance level we would change this.

Rearranging as above, this works out to be the interval

$$
-1.92 \leq  \tau \leq 14.98.
$$

Notice that zero is in this interval, consistent with the fact that we failed to reject the null hypothesis.
:::

Some things to note

  * We can compute this confidence interval whether or not we failed to reject the null hypothesis that $\tau=0$, and for significance levels other than 0.05.
  * In most cases, reporting the confidence interval is much more informative than simply reporting the $P$-value. In our Captopril example, we found that a negative treatment effect (ie. Captopril reducing blood pressure less than the placebo) of more than 2 mmHg was very unlikely, whereas a positive effective (Captopril reducing blood pressure) of up to 15 mmHg was plausible. If Captopril were inexpensive and had very limited side effects (sadly neither of which is true) it may still be an attractive drug.
  * These confidence intervals are exactly the same as you have learned before, but we emphasise them because they are very informative in randomised controlled trials (but not so often used!).

At the post trial stage, when we have data, the confidence interval is the most useful link to the concept of *power*, which we thought about at the planning stage. Remember that the power function is defined as

$$\psi \left(\tau\right) = P\left(\text{Reject }H_0\mid \tau\neq 0\right),$$ that is, the probability that we successfully reject $H_0$ (that $\tau=0$) given that there is a non-zero treatment effect $\tau\neq 0$. This was calculated in terms of the theoretical model of the trial, and in terms of some minimum detectable effect size $\tau_M$ that we wanted to be able to correctly detect with probability $1-\beta$ (the power). Sometimes people attempt to re-calculate the power after the trial, to detect whether the trial was underpowered. However, now we have actual data. If we failed to reject $H_0$ and $\tau_M$ is in the confidence interval for $\tau$, then that is a good indication that our trial was indeed underpowered.

### Bonferroni correction

(and possibly other types of adjustment? - where to put this?!)

## Using baseline values {#baseline}

In our example above, our primary outcome variable $X$ was the systolic blood pressure of each participant at the end of the intervention period. However, we see in Table \@ref(tab:captoprildata) that we also have *baseline* measurements: measurements of systolic blood pressure for each patient from before the intervention period. Baseline measurements are useful primarily for two reasons:

  1. They can be used to assess the balance of the design.
  2. They can be used in the analysis.
  
We will demonstrate these by returning to our Captopril example.

::: {.example}

Firstly, we use the baseline systolic blood pressure to assess balance. The placebo group has a mean of 146.6 mmHg and an SD of 12.3 mmHg, whereas the Captopril group has mean 148.0 mmHg, SD 11.4 mmHg. While these aren&#39;t identical, they are sufficiently similar to think they wouldn&#39;t affect our analysis. In a study this small there is likely to be some difference.

Secondly, since we are interested in whether the use of Captopril has reduced blood pressure for each individual, and these individuals had different baseline values, it makes sense to compare not just the outcome but the difference from baseline to outcome for each individual. We can see individual data in Table \@ref(tab:captoprildiff) and summary statistics in Table \@ref(tab:captoprildiffsumm).

&lt;table&gt;
&lt;caption&gt;(\#tab:captoprildiff)Data for the Captopril trial from @hommel1986effect, with differences shown.&lt;/caption&gt;
&lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; Patient (ID) &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; Baseline (B) &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; Outcome at 1 week (X) &lt;/th&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt; Trial Arm &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; Difference &lt;/th&gt;
  &lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 1 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 147 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 137 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -10 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 2 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 129 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 120 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 3 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 158 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 141 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -17 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 4 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 164 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 137 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -27 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 5 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 134 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 140 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 6 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 6 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 155 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 144 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -11 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 7 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 151 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 134 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -17 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 8 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 141 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 123 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -18 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 9 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 153 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 142 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -11 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 1 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 133 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 139 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 6 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 2 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 129 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 134 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 3 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 152 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 136 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -16 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 4 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 161 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 151 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -10 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 5 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 154 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 147 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -7 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 6 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 141 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 137 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -4 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 7 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 156 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 149 &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -7 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;table&gt;
&lt;caption&gt;(\#tab:captoprildiffsumm)Summary statistics for each group.&lt;/caption&gt;
&lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt;   &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; Sample Size &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; Mean (mmHg) &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; SD (mmHg) &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; SE of mean (mmHg) &lt;/th&gt;
  &lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Captopril &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 9 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -12.67 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 8.99 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 3.00 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; Placebo &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 7 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; -4.71 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 7.91 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 2.99 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

Now we can perform our test as before, in which case we find

$$ t = \frac{-4.71 - (-12.67)}{8.54\sqrt{\frac{1}{7}+\frac{1}{9}}} = 1.850 $$
where 8.54 is the pooled standard deviation (as before). Under the null distribution of no difference, this has a $t$-distribution with 14 degrees of freedom, and so we have a $P$-value of 0.086. Our 0.95 confidence interval is

$$ -4.71 - (-12.67) \pm t_{14;\,0.975}\times 8.54\sqrt{\frac{1}{7}+\frac{1}{9}} = \left[-1.3,\,17.2\right].$$
We see that taking into account the baseline values in this way has slightly reduced the $P$-value and shifted the confidence interval slightly higher. Though at the $\alpha = 0.05$ level we still don&#39;t have significance.
:::

We will now look into why the confidence interval and $P$-value changed in this way, before going on to another way of taking into account the baseline value.

Let&#39;s label the baseline measurement for each group $B_1$ and $B_2$, and the outcome measurements $X_1,\,X_2$, where we will take group 1 to be the placebo group and group 2 to be the treatment group. Because all participants have been randomised from the same population, we have

$$\operatorname{E}\left(B_1\right) = \operatorname{E}\left(B_2\right) = \mu_B.$$
Assuming some treatment effect $\tau$ (which could still be zero) we have

$$
\begin{aligned}
\operatorname{E}\left(X_1\right) &amp; = \mu\\
\operatorname{E}\left(X_2\right) &amp; = \mu + \tau.
\end{aligned}
$$
Usually we will assume that

$$\operatorname{Var}\left(X_1\right) = \operatorname{Var}\left(X_2\right) = \operatorname{Var}\left(B_1\right) = \operatorname{Var}\left(B_2\right) = \sigma^2,$$
and this is generally fairly reasonable in practice.

Notice that for the two analyses we have performed so far (comparing outcomes and comparing differences) we have

$$
\begin{aligned}
\operatorname{E}\left(X_2\right) - \operatorname{E}\left(X_1\right) &amp; = \left(\mu + \tau\right) - \mu = \tau\\
\operatorname{E}\left(X_2 - B_2\right) - \operatorname{E}\left(X_1 - B_1\right) &amp; = \left(\mu - \mu_B + \tau\right) - \left(\mu - \mu_B\right) = \tau,
\end{aligned}
$$
that is, both are unbiased estimators of $\tau$.

However, whereas the first is based on data with variance $\sigma^2$, the second has

$$
\begin{aligned}
\operatorname{Var}\left(X_2-B_2\right) &amp; = \operatorname{Var}\left(X_2\right) + \operatorname{Var}\left(B_2\right) - 2\operatorname{cov}\left(X_2,B_2\right)\\
&amp; = \sigma^2 + \sigma^2 - 2\rho\sigma^2 \\
&amp; = 2\sigma^2\left(1-\rho\right),
\end{aligned}
$$
where $\rho$ is the true correlation between $X$ and $B$, and is assumed to be the same in either group. Therefore, if $\frac{1}{2}&lt;\rho\leq 1$ there will be a smaller variance when comparing differences. However, if $0\leq\rho&lt;\frac{1}{2}$, the variance will be smaller when comparing outcome variables.

Intuitively, this seems reasonable: if the correlation between baseline and outcome measurements is very strong, then we can remove some of the variability between participants by taking into account their baseline measurement. However, if the correlation is weak, then by including the baseline in the analysis we are essentially just introducing noise.

For our Captopril example, the sample correlation between baseline and outcome is 0.63 in the Captopril group and 0.80 in the Placebo group. This fits with the $P$-value having reduced slightly.

## Analysis of covariance (ANCOVA)

In the previous section we based our analysis on the baseline values being statistically identical draws from the underlying distribution, and therefore having the same expectation and variance.

However, although this is theoretically true, in real life trials there will be some imbalance in the baseline measurements for the different treatment arms. We can see this in our Captopril example, in Figure \@ref(fig:hommel).


&lt;div class=&quot;figure&quot;&gt;
&lt;img src=&quot;CT4H_notes_files/figure-html/hommel-1.png&quot; alt=&quot;Baseline measurements from the Captopril trial @hommel1986effect.&quot; width=&quot;672&quot; /&gt;
&lt;p class=&quot;caption&quot;&gt;(\#fig:hommel)Baseline measurements from the Captopril trial @hommel1986effect.&lt;/p&gt;
&lt;/div&gt;
The baseline measurements are not identical in each group. Indeed, we saw earlier that the means differ by 1.4 mmHg. Although this isn&#39;t a clinically significant difference, or a large enough difference to make us doubt the randomisation procedure, it is still a difference.

The basic principle of ANCOVA is that if there is some correlation between the baseline and outcome measurements, then if the baseline measurements differ, one would expect the outcome measurements to differ, even if there is no treatment effect (ie. if $\tau=0$). Indeed, how do we decide how much of the difference in outcome is down to the treatment itself, and how much is simply the difference arising from different samples?

This issue arises in many trials, particularly where there is a strong correlation between baseline and outcome measurements.

### The theory

Suppose the outcome for a clinical trial is $X$ and the baseline is $B$. $X$ has mean $\mu$ in the control group (C) and mean $\mu+\tau$ in the test group (T), and as usual our aim is to determine the extent of $\tau$, the treatment effect. We suppose also that $X$ has variance $\sigma^2$ in both groups.

The same quantity is measured at the start of the trial, and this is the baseline $B$, which we can assume to have true mean $\mu_B$ in both groups (because of randomisation) and variance $\sigma^2$. We also assume that the true correlation between $B$ and $X$ is $\rho$ in each group. Finally, we assume that both treatment groups are of size $N$.

We therefore have $2N$ patients, and so we observe baseline measurements $b_1,\,b_2,\ldots,b_{2N}$. Given these values, we have

$$
\begin{aligned}
\operatorname{E}\left(X_i\mid{b_i}\right) &amp;= \mu + \rho\left(b_i - \mu_B\right)\text{ in the control group}\\
\operatorname{E}\left(X_i\mid{b_i}\right) &amp;= \mu +\tau + \rho\left(b_i - \mu_B\right)\text{ in the test group.}
\end{aligned}
$$

From this, we find that

\begin{equation}
\operatorname{E}\left(\bar{X}_T - \bar{X}_C\mid{\bar{b}_T,\,\bar{b}_C}\right) = \tau + \rho\left(\bar{b}_T - \bar{b}_C\right).
\tag{4.1}
\end{equation}
That is, if there is a difference in the baseline mean between the control and test groups, then the difference in outcome means is not an unbiased estimator of the treatment effect $\tau$. Assuming $\rho&gt;0$ (which is almost always the case) then if $\bar{b}_T&gt;\bar{b}_C$ the difference in outcome means overestimates $\tau$. Conversely, if $\bar{b}_T&lt;\bar{b}_C$, the difference in outcome means underestimates $\tau$. The only situation in which the difference in outcome means is an unbiased estimator is when $\rho=0$, however this is not common in practice.

Comparing the difference between outcome and baseline, as we did in \@ref(baseline), does not solve this problem, since we have

$$\operatorname{E}\left[\left(\bar{X}_T - \bar{b}_T\right) - \left(\bar{X}_C - \bar{b}_C\right)\mid{\bar{b}_T,\,\bar{b}_C}\right] = \tau + \left(\rho-1\right)\left(\bar{b}_T - \bar{b}_C\right),$$
which is similarly unbiased (unless $\rho=1$, which is never the case).

Notice, however, that if we use as our estimator

$$\left(\bar{X}_T - \bar{X}_C\right) - \rho \left(\bar{b}_T - \bar{b}_C\right)$$ then, following from Equation \@ref(eq:diffexp) we have

$$\operatorname{E}\left[\left(\bar{X}_T - \bar{X}_C\right) - \rho \left(\bar{b}_T - \bar{b}_C\right)\mid{\bar{b}_T,\,\bar{b}_C}\right] = \tau + \rho\left(\bar{b}_T - \bar{b}_C\right)- \rho\left(\bar{b}_T - \bar{b}_C\right) = \tau. $$

### The practice

In the previous section we established an unbiased estimate of the treatment effect that takes into account the baseline measurements. However, we can&#39;t use it as a model, because there are a few practical barriers:

  * Our estimate for $\tau$ relies on the correlation $\lambda$, which is unknown
  * In real life, the groups are unlikely to have equal size and variance, so ideally we&#39;d lose these constraints
  
We can solve both of these by fitting the following statistical model to the observed outcomes $x_i$:

$$
\begin{aligned}
x_i &amp; = \mu + \gamma b_i + \epsilon_i &amp; \text{ in group C}\\
x_i &amp; = \mu + \tau + \gamma b_i + \epsilon_i &amp; \text{ in group T}&amp;.
\end{aligned}
$$
Here, the $\epsilon_i$ are independent errors with distribution $N\left(0,\,\sigma^2\right)$, the $b_i$ are the baseline measurements for $i=1,\ldots,N_T+N_C$, for groups $T$ and $C$ with sizes $N_T$ and $N_C$ respectively. Sometimes this is written instead in the form

$$ x_i = \mu + \tau G_i+ \gamma b_i + \epsilon_i $$
where $G_i$ is 1 if participant $i$ is in group $T$ and 0 if they&#39;re in group $C$. This is a factor variable, which you may remember from Stats Modelling II (if you took it). If $G_i=1$ (ie. participant $i$ is in group $T$) then $\tau$ is added. If $G_i=0$ (ie. participant $i$ is in group $C$) then it isn&#39;t.

We now have four parameters to estimate: $\mu,\,\tau,\,\gamma$ and $\sigma^2$. For the first three we can use least squares (as you have probably seen for linear regression). Our aim is to minimise the sum of squares

$$S\left(\mu,\, \tau,\,\gamma\right) = \sum\limits_{i\text{ in }T} \left(x_i - \mu - \tau - \gamma b_i\right)^2 + \sum\limits_{i\text{ in }C} \left(x_i - \mu - \gamma b_i\right)^2.$$

This leads to estimates $\hat{\mu},\, \hat{\tau}$ and $\hat{\gamma}$. We won&#39;t worry about how this sum is minimised, since we&#39;ll always be using pre-written R functions. We can use the estimates $\hat{\mu},\, \hat{\tau}$ and $\hat{\gamma}$ to estimate $\sigma^2$, using

$$\hat{\sigma}^2 = \frac{S\left(\hat{\mu},\hat{\tau}, \hat{\gamma}\right)}{N_T + N_C -3}.$$
The general form for this is

$$ \hat{\sigma}^2 = \frac{SSE}{n-p},$$
where $SSE$ is the residual sum of squares, $n$ is the number of data points and $p$ the number of parameters (apart from $\sigma^2$) being estimated. If you want to know why that is, you can find out [here](https://pages.stern.nyu.edu/~wgreene/MathStat/GreeneChapter4.pdf) (look particularly at page 62), but we will just take it as given!

As well as generating a fitted value $\hat{\tau}$, we (or rather R!) will also find the standard error of $\hat\tau$, and we can use this to generate a confidence interval for the treatment effect $\tau$.

The technique described above is a well-established statistical method known as **ANCOVA** (short for the **An**alysis of **Cova**riance), which can be implemented in R and many other statistical software packages.

::: {.example}
Let&#39;s now implement ANCOVA on our Captopril data in R.
We do this by first fitting a linear model using &#39;lm&#39;, with baseline measurement and arm as predictor variables and outcome as the predictand.

```r
# Gives same answers as above, so use this!
# Find out what the numbesrs mean
# Background on ANOVA and factor models (SMII)
# Where to include random effects models? Is it in Matthews?
lm_capt = lm(outcome ~ baseline + arm, data = df_hommel)
summary(lm_capt)
```

```
##
## Call:
## lm(formula = outcome ~ baseline + arm, data = df_hommel)
##
## Residuals:
##    Min     1Q Median     3Q    Max
## -9.129 -3.445  1.415  2.959 11.076
##
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  67.5731    19.7577   3.420  0.00456 **
## baseline      0.4578     0.1328   3.446  0.00434 **
## armPlacebo    7.1779     2.9636   2.422  0.03079 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
##
## Residual standard error: 5.869 on 13 degrees of freedom
## Multiple R-squared:  0.5629, Adjusted R-squared:  0.4957
## F-statistic: 8.372 on 2 and 13 DF,  p-value: 0.004608
```

The variable &#39;arm&#39; here is being included as a factor variable, so it behaves like

$$
\text{arm}_i =
\begin{cases}
0 &amp; \text{ if participant }i\text{ is assigned Captopril}\\
1 &amp; \text{ if participant }i\text{ is assigned Placebo}.
\end{cases}
$$
Therefore, for a patient assigned Placebo, a value of 7.1779 is added, as well as the intercept and baseline term. This results in a model with two parallel fitted lines.

&lt;img src=&quot;CT4H_notes_files/figure-html/unnamed-chunk-14-1.png&quot; width=&quot;672&quot; /&gt;

For our previous methods we have calculated a confidence interval for the treatment effect $\tau$, and we will do that here too. The second column of the linear model summary (above) gives the standard errors of each estimated parameter, and we see that the standard error of $\hat{\tau}$ is 2.9636. Therefore, to construct a 95/% confidence interval for $\hat{\tau}$, we use (to 3 decimal places)

$7.178\; \pm\; t_{0.975;13}\times{2.964}  = \left(0.775,\; 13.580\right).$

The model has $n-p=13$ degrees of freedom because there are $n=16$ data points and are estimating $p=3$ parameters.
Notice that unlike our previous confidence intervals, this doesn&#39;t contain zero, and so our analysis has enabled us to conclude that there is a significant reduction in blood pressure with Captopril. However, you can tell from the width of the interval that there is still a lot of uncertainty about $\tau$.

The &#39;Residual standard error&#39; term near the bottom of the linear model summary is the estimate of $\hat{\sigma}$, so here we have $\hat{\sigma}^2 = 5.869^2 = 34.44.$

As with any fitted model, we should check the residuals.


```r
resid_capt = resid(lm_capt)
df_hommel$resid= resid_capt

ggplot(data = df_hommel, aes(x=baseline, y=resid, col=arm)) +
  geom_point() +
  geom_hline(yintercept=0)+
  xlab(&quot;Baseline&quot;)+
  ylab(&quot;Residual&quot;)
```

&lt;img src=&quot;CT4H_notes_files/figure-html/unnamed-chunk-15-1.png&quot; width=&quot;672&quot; /&gt;
These look pretty good, no clear patterns and a similar distribution for each treatment group.

:::

## Some follow-up questions....

This might have raised a few questions, so we will address those now.

### How is this related to ANOVA?


### What if the lines shouldn&#39;t be parallel? The unequal slopes model

In the analysis above, we have assumed that the coefficient $\gamma$ of baseline (the estimate of the correlation between outcome and baseline) is the same in both groups; we have fitted an **equal slopes model**. It isn&#39;t obvious that this should be the case, and indeed we can test for it.

Allowing each group to have a different slope means including an interaction term between baseline and treatment group,

$$ x_i = \mu + \tau G_i+ \gamma b_i + \lambda b_i G_i + \epsilon_i . $$
The term $\lambda b_i G_i$ is 0 if participant $i$ is in group $C$ and $\lambda b_i$ if participant $i$ is in group $T$. Therefore, for participants in group $C$, the gradient is still $\gamma$, but for participants in group $T$ it is now $\gamma + \lambda$. We can test whether this interaction term should be included (that is, whether we should fit an unequal slopes model) by including it in a model and analysing the results.

:::{.example}

Continuing once again with the Captopril dataset, we now fit the model


```r
lm_capt_int = lm(outcome ~ arm + baseline + baseline:arm, data = df_hommel)
summary(lm_capt_int)
```

```
##
## Call:
## lm(formula = outcome ~ arm + baseline + baseline:arm, data = df_hommel)
##
## Residuals:
##    Min     1Q Median     3Q    Max
## -9.094 -3.475  1.412  2.979 11.145
##
## Coefficients:
##                     Estimate Std. Error t value Pr(&gt;|t|)  
## (Intercept)         66.85150   28.02488   2.385   0.0344 *
## armPlacebo           8.72484   40.93465   0.213   0.8348  
## baseline             0.46272    0.18886   2.450   0.0306 *
## armPlacebo:baseline -0.01051    0.27723  -0.038   0.9704  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
##
## Residual standard error: 6.108 on 12 degrees of freedom
## Multiple R-squared:  0.563,  Adjusted R-squared:  0.4537
## F-statistic: 5.153 on 3 and 12 DF,  p-value: 0.01614
```

```r
anova(lm_capt_int) # still don&#39;t think I need to include this
```

```
## Analysis of Variance Table
##
## Response: outcome
##              Df Sum Sq Mean Sq F value   Pr(&gt;F)   
## arm           1 167.58  167.58  4.4919 0.055594 .
## baseline      1 409.11  409.11 10.9659 0.006207 **
## arm:baseline  1   0.05    0.05  0.0014 0.970391   
## Residuals    12 447.69   37.31                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
```
We see that the $p$-value for the coefficient $\lambda$ (seen in the `arm:baseline` row) is not at all significant (0.97). Therefore we can be confident that there is no need to fit unequal slopes for this dataset. This fits with our earlier conclusion (from inspecting the residuals) that just including first order terms is fine.
:::


### Didn&#39;t we say that $X_T - X_C$ was an unbiased estimator of $\tau$?


### Can we include any other covariates?

When our estimated treatment effect was $\hat\tau = \left(\bar{x}_T - \bar{b}_T\right) - \left(\bar{x}_C - \bar{b}_C\right)$, we could the only other variable we could take into account was the baseline measurement, because it is on the same scale as the outcome $X$. However, in ANCOVA, our treatment effect is

$$ \hat\tau = \left(\bar{x}_T - \bar{x}_C\right) - \hat\gamma\left(\bar{b}_T - \bar{b}_C\right), $$
and the inclusion of the coefficient $\gamma$ means that we can include other covariates on different scales too. The key issue is that we can only include as covariates things that were already known before allocation. This is because they cannot, at that point, have been affected by the treatment. Indeed, as a rule, any variable that was used in the randomisation procedure (this particularly applies to minimisation and stratified sampling) should be included in the analysis.

::: {.example}
The data for this example is taken from @datarium. In this study, 60 patients take part in a trial investigating the effect of a new treatment and exercise on their stress score, after adjusting for age.
There are two treatment levels (yes or no) and three exercise levels (low, moderate and high) and 10 participants for each combination of treatment and exercise levels. Because in ANCOVA we fit a coefficient to every covariate, we can include exercise (another factor variable) and age (a continuous variable) in this analysis.

&lt;div data-pagedtable=&quot;false&quot;&gt;
  &lt;script data-pagedtable-source type=&quot;application/json&quot;&gt;
{&quot;columns&quot;:[{&quot;label&quot;:[&quot;id&quot;],&quot;name&quot;:[1],&quot;type&quot;:[&quot;int&quot;],&quot;align&quot;:[&quot;right&quot;]},{&quot;label&quot;:[&quot;score&quot;],&quot;name&quot;:[2],&quot;type&quot;:[&quot;dbl&quot;],&quot;align&quot;:[&quot;right&quot;]},{&quot;label&quot;:[&quot;treatment&quot;],&quot;name&quot;:[3],&quot;type&quot;:[&quot;fct&quot;],&quot;align&quot;:[&quot;left&quot;]},{&quot;label&quot;:[&quot;exercise&quot;],&quot;name&quot;:[4],&quot;type&quot;:[&quot;fct&quot;],&quot;align&quot;:[&quot;left&quot;]},{&quot;label&quot;:[&quot;age&quot;],&quot;name&quot;:[5],&quot;type&quot;:[&quot;dbl&quot;],&quot;align&quot;:[&quot;right&quot;]}],&quot;data&quot;:[{&quot;1&quot;:&quot;1&quot;,&quot;2&quot;:&quot;95.6&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;59&quot;},{&quot;1&quot;:&quot;2&quot;,&quot;2&quot;:&quot;82.2&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;65&quot;},{&quot;1&quot;:&quot;3&quot;,&quot;2&quot;:&quot;97.2&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;70&quot;},{&quot;1&quot;:&quot;4&quot;,&quot;2&quot;:&quot;96.4&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;66&quot;},{&quot;1&quot;:&quot;5&quot;,&quot;2&quot;:&quot;81.4&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;61&quot;},{&quot;1&quot;:&quot;6&quot;,&quot;2&quot;:&quot;83.6&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;65&quot;},{&quot;1&quot;:&quot;7&quot;,&quot;2&quot;:&quot;89.4&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;57&quot;},{&quot;1&quot;:&quot;8&quot;,&quot;2&quot;:&quot;83.8&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;61&quot;},{&quot;1&quot;:&quot;9&quot;,&quot;2&quot;:&quot;83.3&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;58&quot;},{&quot;1&quot;:&quot;10&quot;,&quot;2&quot;:&quot;85.7&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;55&quot;},{&quot;1&quot;:&quot;11&quot;,&quot;2&quot;:&quot;97.2&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;62&quot;},{&quot;1&quot;:&quot;12&quot;,&quot;2&quot;:&quot;78.2&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;61&quot;},{&quot;1&quot;:&quot;13&quot;,&quot;2&quot;:&quot;78.9&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;60&quot;},{&quot;1&quot;:&quot;14&quot;,&quot;2&quot;:&quot;91.8&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;59&quot;},{&quot;1&quot;:&quot;15&quot;,&quot;2&quot;:&quot;86.9&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;55&quot;},{&quot;1&quot;:&quot;16&quot;,&quot;2&quot;:&quot;84.1&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;57&quot;},{&quot;1&quot;:&quot;17&quot;,&quot;2&quot;:&quot;88.6&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;60&quot;},{&quot;1&quot;:&quot;18&quot;,&quot;2&quot;:&quot;89.8&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;63&quot;},{&quot;1&quot;:&quot;19&quot;,&quot;2&quot;:&quot;87.3&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;62&quot;},{&quot;1&quot;:&quot;20&quot;,&quot;2&quot;:&quot;85.4&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;57&quot;},{&quot;1&quot;:&quot;21&quot;,&quot;2&quot;:&quot;81.8&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;58&quot;},{&quot;1&quot;:&quot;22&quot;,&quot;2&quot;:&quot;65.8&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;56&quot;},{&quot;1&quot;:&quot;23&quot;,&quot;2&quot;:&quot;68.1&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;57&quot;},{&quot;1&quot;:&quot;24&quot;,&quot;2&quot;:&quot;70.0&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;59&quot;},{&quot;1&quot;:&quot;25&quot;,&quot;2&quot;:&quot;69.9&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;59&quot;},{&quot;1&quot;:&quot;26&quot;,&quot;2&quot;:&quot;75.1&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;60&quot;},{&quot;1&quot;:&quot;27&quot;,&quot;2&quot;:&quot;72.3&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;55&quot;},{&quot;1&quot;:&quot;28&quot;,&quot;2&quot;:&quot;70.9&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;53&quot;},{&quot;1&quot;:&quot;29&quot;,&quot;2&quot;:&quot;71.5&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;55&quot;},{&quot;1&quot;:&quot;30&quot;,&quot;2&quot;:&quot;72.5&quot;,&quot;3&quot;:&quot;yes&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;58&quot;},{&quot;1&quot;:&quot;31&quot;,&quot;2&quot;:&quot;84.9&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;68&quot;},{&quot;1&quot;:&quot;32&quot;,&quot;2&quot;:&quot;96.1&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;62&quot;},{&quot;1&quot;:&quot;33&quot;,&quot;2&quot;:&quot;94.6&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;61&quot;},{&quot;1&quot;:&quot;34&quot;,&quot;2&quot;:&quot;82.5&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;54&quot;},{&quot;1&quot;:&quot;35&quot;,&quot;2&quot;:&quot;90.7&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;59&quot;},{&quot;1&quot;:&quot;36&quot;,&quot;2&quot;:&quot;87.0&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;63&quot;},{&quot;1&quot;:&quot;37&quot;,&quot;2&quot;:&quot;86.8&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;60&quot;},{&quot;1&quot;:&quot;38&quot;,&quot;2&quot;:&quot;93.3&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;67&quot;},{&quot;1&quot;:&quot;39&quot;,&quot;2&quot;:&quot;87.6&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;60&quot;},{&quot;1&quot;:&quot;40&quot;,&quot;2&quot;:&quot;92.4&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;low&quot;,&quot;5&quot;:&quot;67&quot;},{&quot;1&quot;:&quot;41&quot;,&quot;2&quot;:&quot;100.0&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;75&quot;},{&quot;1&quot;:&quot;42&quot;,&quot;2&quot;:&quot;80.5&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;54&quot;},{&quot;1&quot;:&quot;43&quot;,&quot;2&quot;:&quot;92.9&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;57&quot;},{&quot;1&quot;:&quot;44&quot;,&quot;2&quot;:&quot;84.0&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;62&quot;},{&quot;1&quot;:&quot;45&quot;,&quot;2&quot;:&quot;88.4&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;65&quot;},{&quot;1&quot;:&quot;46&quot;,&quot;2&quot;:&quot;91.1&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;60&quot;},{&quot;1&quot;:&quot;47&quot;,&quot;2&quot;:&quot;85.7&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;58&quot;},{&quot;1&quot;:&quot;48&quot;,&quot;2&quot;:&quot;91.3&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;61&quot;},{&quot;1&quot;:&quot;49&quot;,&quot;2&quot;:&quot;92.3&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;65&quot;},{&quot;1&quot;:&quot;50&quot;,&quot;2&quot;:&quot;87.9&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;moderate&quot;,&quot;5&quot;:&quot;57&quot;},{&quot;1&quot;:&quot;51&quot;,&quot;2&quot;:&quot;91.7&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;56&quot;},{&quot;1&quot;:&quot;52&quot;,&quot;2&quot;:&quot;88.6&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;58&quot;},{&quot;1&quot;:&quot;53&quot;,&quot;2&quot;:&quot;75.8&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;58&quot;},{&quot;1&quot;:&quot;54&quot;,&quot;2&quot;:&quot;75.7&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;58&quot;},{&quot;1&quot;:&quot;55&quot;,&quot;2&quot;:&quot;75.3&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;52&quot;},{&quot;1&quot;:&quot;56&quot;,&quot;2&quot;:&quot;82.4&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;53&quot;},{&quot;1&quot;:&quot;57&quot;,&quot;2&quot;:&quot;80.1&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;60&quot;},{&quot;1&quot;:&quot;58&quot;,&quot;2&quot;:&quot;86.0&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;62&quot;},{&quot;1&quot;:&quot;59&quot;,&quot;2&quot;:&quot;81.8&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;61&quot;},{&quot;1&quot;:&quot;60&quot;,&quot;2&quot;:&quot;82.5&quot;,&quot;3&quot;:&quot;no&quot;,&quot;4&quot;:&quot;high&quot;,&quot;5&quot;:&quot;61&quot;}],&quot;options&quot;:{&quot;columns&quot;:{&quot;min&quot;:{},&quot;max&quot;:[10]},&quot;rows&quot;:{&quot;min&quot;:[10],&quot;max&quot;:[10]},&quot;pages&quot;:{}}}
  &lt;/script&gt;
&lt;/div&gt;

The table below shows the mean and standard deviation of age for each combination of treatment and exercise level. If we were being picky / thorough, we might note that (perhaps unsurprisingly!) the mean and standard deviation of age are both lower in the high exercise groups. This might well affect our analysis, but we won&#39;t go into this now.

&lt;table&gt;
&lt;thead&gt;
  &lt;tr&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt; treatment &lt;/th&gt;
   &lt;th style=&quot;text-align:left;&quot;&gt; exercise &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; mean &lt;/th&gt;
   &lt;th style=&quot;text-align:right;&quot;&gt; sd &lt;/th&gt;
  &lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; yes &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; low &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 61.7 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 4.691600 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; yes &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; moderate &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 59.6 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 2.590581 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; yes &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; high &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 57.0 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 2.211083 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; no &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; low &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 62.1 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 4.332051 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; no &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; moderate &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 61.4 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 5.947922 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; no &lt;/td&gt;
   &lt;td style=&quot;text-align:left;&quot;&gt; high &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 57.9 &lt;/td&gt;
   &lt;td style=&quot;text-align:right;&quot;&gt; 3.381321 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

Fitting a linear model, we see that treatment, high levels of exercise and age have an effect on stress.


```r
lm_stresslin = lm(score ~ treatment + exercise + age, data = stress)
summary(lm_stresslin)
```

```
##
## Call:
## lm(formula = score ~ treatment + exercise + age, data = stress)
##
## Residuals:
##     Min      1Q  Median      3Q     Max
## -9.0261 -3.7497 -0.4285  3.0943 13.3696
##
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      55.72934   10.91888   5.104 4.27e-06 ***
## treatmentno       4.32529    1.37744   3.140  0.00272 **
## exercisemoderate  0.08735    1.69032   0.052  0.95897    
## exercisehigh     -9.61841    1.84741  -5.206 2.96e-06 ***
## age               0.49811    0.17648   2.822  0.00662 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
##
## Residual standard error: 5.288 on 55 degrees of freedom
## Multiple R-squared:  0.6045, Adjusted R-squared:  0.5757
## F-statistic: 21.01 on 4 and 55 DF,  p-value: 1.473e-10
```

In particular, taking a high level of exercise reduced participants&#39; stress scores by around 9.6, and the treatment reduced stress scores by around 4.3. Participants&#39; stress scores increased slightly with age (just under half a point per year!).

We can plot the residuals to check that the model is a reasonable fit

&lt;img src=&quot;CT4H_notes_files/figure-html/unnamed-chunk-20-1.png&quot; width=&quot;672&quot; /&gt;

:::


## Some general principles of Analysis

There are some assumptions we&#39;re making here, and so we need to be careful when fitting an ANCOVA model.

  * We&#39;re assuming that the residual variance is the same for both groups
  * We&#39;re assuming that the coefficient of the baseline is the same for both groups: only the intercept is changing.
  
We can&#39;t check the first until after

::: {.example}

Before fitting our ANCOVA model we should first have checked that there&#39;s no significant relationship between the covariate (in this case the baseline) and the treatment group, which we can do using ANOVA:


```r
# There&#39;s probably a better way to do this - check online articles
model_aov_capt = aov(baseline ~ arm, data = df_hommel)
summary(model_aov_capt)
```

```
##             Df Sum Sq Mean Sq F value Pr(&gt;F)
## arm          1      8    8.04   0.058  0.814
## Residuals   14   1952  139.41
```

If the experiment has been properly designed then there shouldn&#39;t be, but this is not always the case, and indeed depending on how we do the randomisation we could be unlucky. If baseline measurements are available before allocation, this can be checked before the trial is run.

:::

&lt;!--chapter:end:04-rctanalysis.Rmd--&gt;

# Working with binary data

So far all everything we&#39;ve covered has related to continuous outcome variables, which we assumed to be normally distributed. This allowed us to use familiar techniques such as the $t$-test, and to take baseline information into account in an accessible way (the linear model / ANCOVA). However, very often clinical trials do not have a continuous, normally distributed output, and in the next two sections we will look at two other common possibilities: binary data (this section) and survival data (next section).

A binary outcome might be something like &#39;the patient was alive 2 years after the procedure&#39; or not, or &#39;the patient was clear of eczema within a month&#39; or not. Such variables are often coded as success or failure, or 0 or 1.
        
## Sample size for a binary variable {#ss-bin}
        
For a trial whose primary outcome variables are binary, the sample size calculations we derived in Chapter \@ref(rct-plan) will not work.
      
Suppose we conduct a trial with a binary primary outcome variable and two groups, A and B, containing $n_A$ and $n_B$ participants respectively. The number of successes in each group, $R_A$ and $R_B$, will be Binomially distributed,
      
\begin{align*}
      R_A &amp;\sim{Bi\left(n_A,\, \pi_A\right)} \\
      R_B &amp;\sim{Bi\left(n_B,\,\pi_B\right)}.
\end{align*}\]</span></p>
<p>Our null hypothesis now is therefore that <span class="math inline">\(\pi_A = \pi_B\)</span>, ie. that the probability of success is the same in each group, and we will need enough participants to test this hypothesis with sufficient power. With the trial data we will be able to produce estimates</p>
<p><span class="math display">\[\begin{align*}
      p_A &amp; = \frac{R_A}{n_A} \\
      p_B &amp; = \frac{R_B}{n_B}.
\end{align*}\]</span></p>
<p>Recall that the variance of <span class="math inline">\(p_X\)</span> (where <span class="math inline">\(X\)</span> is <span class="math inline">\(A\)</span> or <span class="math inline">\(B\)</span>) is <span class="math inline">\(\pi_X\left(1-\pi_X\right)\)</span>, such that the variance depends on the mean. This means there is no free parameter equivalent to <span class="math inline">\(\sigma\)</span> in the binary situation, and the number of participants required will depend on the approximate value of <span class="math inline">\(\pi_A\)</span> and <span class="math inline">\(\pi_B\)</span>. This makes the derivation of a sample size formula somewhat more complicated, and so we first of all make a transformation to remove the dependence of mean and variance. To do this we use an approximation technique called <em>the delta method</em>.</p>
</div>
<div id="the-delta-method" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> The Delta Method<a href="sec-allocation.html#the-delta-method" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We start with a random variable <span class="math inline">\(X\)</span> that has mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2 = \sigma^2\left(\mu\right)\)</span>, ie. its variance depends on its mean. If we have a ‘well-behaved’ (infinitely differentiable etc.) function <span class="math inline">\(f\left(X\right)\)</span>, what are its mean and variance? To find this exactly requires us to evaluate a sum or integral, and this may be analytically intractable, so we use instead a crude approximation.</p>
<p>First, we expand <span class="math inline">\(f\left(X\right)\)</span> in a first-order Taylor series about <span class="math inline">\(\mu\)</span>, which gives us</p>
<p><span class="math display" id="eq:delta1">\[\begin{equation}
      f\left(X\right) \approx f\left(\mu\right) + \left(X-\mu\right)f&#39;\left(\mu\right)
\tag{4.2}
\end{equation}\]</span></p>
<p>and therefore</p>
<p><span class="math display" id="eq:delta2">\[\begin{equation}
\left(f\left(X\right) - f\left(\mu\right)\right)^2 \approx \left(X-\mu\right)^2\left[f&#39;\left(\mu\right)\right]^2.
\tag{4.3}
\end{equation}\]</span></p>
<p>If we take expectations of Equation <a href="sec-allocation.html#eq:delta1">(4.2)</a> we find <span class="math inline">\(E\left(f\left(X\right)\right) \approx f\left(\mu\right)\)</span>. We can use this in the left-hand side of Equation <a href="sec-allocation.html#eq:delta2">(4.3)</a> so that when we take expectations of Equation <a href="sec-allocation.html#eq:delta2">(4.3)</a> we find</p>
<p><span class="math display" id="eq:delta3">\[\begin{equation}
  \operatorname{var}\left(f\left(X\right)\right) = \sigma^2\left(\mu\right)\left[f&#39;\left(\mu\right)\right]^2,
\tag{4.4}
\end{equation}\]</span></p>
<p>where both sides come from</p>
<p><span class="math display">\[\operatorname{var}\left(X\right) = \operatorname{E}\left[\left(X - \mu\right)^2\right] .\]</span> THis series of approximations, which generally works well, is the Delta method.</p>
<p>One way in which it is often used, and the way in which we will use it now, is to find a transformation <span class="math inline">\(f\left(X\right)\)</span> for which (at least approximately) the variance is unrelated to the mean. To do this, we solve the differential equation</p>
<p><span class="math display">\[ \operatorname{var}\left[f\left(X\right)\right] = \sigma^2\left(\mu\right) \left[f&#39;\left(\mu\right)\right]^2 = \text{constant}. \]</span>
In the case of proportions for a binary variable, this becomes</p>
<p><span class="math display">\[ \frac{\pi\left(1-\pi\right)}{n} \left[f&#39;\left(\pi\right)\right]^2 = K\]</span>
for some constant <span class="math inline">\(K\)</span>. We can rearrange this to</p>
<p><span class="math display">\[f\left(\pi\right) \propto{ \int{\frac{1}{\sqrt{\pi\left(1-\pi\right)}}d\pi}}\]</span>
and by substituting <span class="math inline">\(\pi = u^2\)</span> we find</p>
<p><span class="math display">\[\begin{align*}
f\left(\pi\right) &amp; \propto \int{\frac{1}{\sqrt{u^2\left(1-u^2\right)}}2u\,du}\\
&amp;\propto \int{\frac{1}{\sqrt{1 - u^2}}}du\\
&amp; \propto \arcsin{\left(\sqrt{\pi}\right)}.
\end{align*}\]</span></p>
<p>Setting <span class="math inline">\(u=\sqrt{\pi}\)</span> again and <span class="math inline">\(f\left(\pi\right) = \arcsin\left(\sqrt{\pi}\right)\)</span> and using the chain rule, we find</p>
<p><span class="math display">\[\left[f&#39;\left(\pi\right)\right]^2 = \frac{1}{\sqrt{4\pi\left(1-\pi\right)}} .\]</span>
Finally, we can substitute this into Equation <a href="sec-allocation.html#eq:delta3">(4.4)</a>, with <span class="math inline">\(f\left(X\right) = \arcsin\left(\sqrt{X}\right)\)</span> to find</p>
<p><span class="math display">\[\begin{align*}
  \operatorname{var}\left[f\left(X\right)\right] &amp; \approx \sigma^2\left(\pi\right)\left[f&#39;\left(\pi\right)\right]^2  \\
&amp; \approx{\frac{\pi\left(1-\pi\right)}{n}\cdot\frac{1}{4\pi\left(1-\pi\right)}}\\
&amp; \approx{\frac{1}{4n}},
\end{align*}\]</span></p>
<p>and we have achieved our aim of finding a transformation of <span class="math inline">\(X\)</span> whose variance is not related to the mean. This is sometimes called the <em>angular transformation</em>.</p>
</div>
<div id="a-sample-size-formula" class="section level3 hasAnchor" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> A sample size formula<a href="sec-allocation.html#a-sample-size-formula" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For a binary variable, our estimate <span class="math inline">\(p_X\)</span> (the proportion of successes in group <span class="math inline">\(X\)</span>) is approximately normally distributed, since the central limit theorem applies. This is not true for small values of <span class="math inline">\(n\)</span> (less than around 30, which is very small for a clinical trial) or for values of <span class="math inline">\(\pi\)</span> close to 0 or 1, say <span class="math inline">\(\pi&lt;0.15\)</span> or <span class="math inline">\(\pi&gt;0.85\)</span> (this is more likely to be an issue for some trials).</p>
<p>The linear approximation in Equation <a href="sec-allocation.html#eq:delta1">(4.2)</a> shows us that if <span class="math inline">\(p_X\)</span> is normally distributed then <span class="math inline">\(f\left(p_X\right) = \arcsin\left(\sqrt{p_X}\right)\)</span> will be [approximately] normally distributed too. In fact, <span class="math inline">\(\arcsin\left(\sqrt{p_A}\right)\)</span> is approximately normally distributed with mean <span class="math inline">\(\arcsin{\left(\sqrt{\pi_A}\right)}\)</span> and variance <span class="math inline">\(1/\left(4\pi_A\right)\)</span>. Using this information, we can test <span class="math inline">\(H_0:\,\pi_A =\pi_B\)</span> at the 100<span class="math inline">\(\alpha\)</span>% confidence level by using the variable</p>
<p><span class="math display">\[
D =  \frac{\arcsin{\left(\sqrt{p_A}\right)} - \arcsin{\left(\sqrt{p_B}\right)}}{\frac{1}{\sqrt{4nA}} + \frac{1}{\sqrt{4n_B}}}=  \frac{\arcsin{\left(\sqrt{p_A}\right)} - \arcsin{\left(\sqrt{p_B}\right)}}{\frac{1}{2}\lambda\left(n_A,n_B\right)},
\]</span>
which is analogous to the variable <span class="math inline">\(D\)</span> constructed in Section <a href="rct-plan.html#sec-measDcont">2.1.3</a>; the difference in <span class="math inline">\(f\left(p_A\right)\)</span> and <span class="math inline">\(\f\left(p_B\right)\)</span> divided by the standard error of the difference.</p>
<p>Using the same logic as in Sections <a href="rct-plan.html#sec-power">2.1.4</a> and <a href="rct-plan.html#sec-ssformulacont">2.1.5</a>, the starting place for a sample size formula to achieve significance level <span class="math inline">\(\alpha\)</span> and power <span class="math inline">\(\beta\)</span> is</p>
<p><span class="math display">\[
\frac{2\left(\arcsin{\left(\sqrt{\pi_A}\right)} - \arcsin{\left(\sqrt{\pi_B}\right)}\right)}{\lambda\left(n_A,n_B\right)} = z_\beta + z_{\frac{\alpha}{2}}.
\]</span>
For two groups of equal size <span class="math inline">\(N\)</span>, this leads us to</p>
<p><span class="math display" id="eq:ssbinary">\[\begin{equation}
N = \frac{\left(z_\beta + z_{\frac{\alpha}{2}}\right)^2}{2\left(\arcsin{\left(\sqrt{\pi_A}\right)} - \arcsin{\left(\sqrt{\pi_B}\right)}\right)^2}.
\tag{4.5}
\end{equation}\]</span></p>
<p>Because <span class="math inline">\(\arcsin{\left(\sqrt{\pi_A}\right)} - \arcsin{\left(\sqrt{\pi_B}\right)}\)</span> is not a function of <span class="math inline">\(\pi_A - \pi_B\)</span>, we cannot express this in terms of the difference itself, but instead need to specify the expected probabilities of success in each group. In practice, it is likely that the success rate for the control group <span class="math inline">\(\left(\pi_A\right)\)</span> is well understood, and the probability for the intervention group <span class="math inline">\(\left(\pi_B\right)\)</span> can be specified by using the nearest clinically important value of <span class="math inline">\(\pi_B\)</span>.</p>
<div class="example">
<p><span id="exm:samplesize1" class="example"><strong>Example 4.1  </strong></span><span class="citation">(From <a href="#ref-smith1994randomised">Smith et al. 1994</a>)</span>
This trial compares two approaches to managing malignent low bile duct obstruction: surgical biliary bypass and endoscopic insertion of a stent. The primary outcome variable was ‘Did the patient die within 30d of the procedure?’, and the trial was designed to have <span class="math inline">\(\alpha=0.05,\,\beta=0.95\)</span>, which gives <span class="math inline">\(z_{\frac{\alpha}{2}}=1.96,\,z_{\beta} = 1.65\)</span>. The trial wanted to be able to determine a change in 30 day mortality rate from 0.2 to at most 0.05. Plugging these numbers into Equation <a href="sec-allocation.html#eq:ssbinary">(4.5)</a>) gives us</p>
<p><span class="math display">\[ N = \frac{\left(1.65 + 1.96\right)^2}{2\left(\arcsin{\left(\sqrt{0.2}\right)} - \arcsin{\left(\sqrt{0.05}\right)}\right)^2} = 114.9, \]</span>
and so each group in our trial should contain 115 patients.</p>
<p>If instead our aim had been to detect a change from around 0.5 to 0.35 (the same in terms of <span class="math inline">\(\pi_A - \pi_B\)</span>), we would instead have needed</p>
<p><span class="math display">\[ N = \frac{\left(1.65 + 1.96\right)^2}{2\left(\arcsin{\left(\sqrt{0.5}\right)} - \arcsin{\left(\sqrt{0.35}\right)}\right)^2} = 280.8 ,\]</span>
that is 281 patients per trial arm.</p>
</div>
<p>For a group <span class="math inline">\(n\)</span> of participants, we will have allocated <span class="math inline">\(n_C\)</span> to the control group (group <span class="math inline">\(C\)</span>), and <span class="math inline">\(n_T\)</span> to the treatment group (group <span class="math inline">\(T\)</span>). The natural statistical model to apply to this situation is therefore a binomial distribution, for example in group <span class="math inline">\(C\)</span> the number of ‘successes’ would be modelled by</p>
<p><span class="math display">\[R_C \sim \operatorname{Bi}\left(n_C,\,\pi_C\right).\]</span></p>
<p>Similarly the number of successes in the treatment group can be modelled as
<span class="math display">\[R_T \sim\operatorname{Bi}\left(n_T,\,\pi_T\right),\]</span>
and the focus of our analysis is on comparing <span class="math inline">\(\pi_C\)</span> and <span class="math inline">\(\pi_T\)</span>. To do this we will require point estimates of both quantities and interval estimates for some measure of the discrepancy between them. We will also need ways to test the null hypothesis that <span class="math inline">\(\pi_C = \pi_T.\)</span></p>
</div>
</div>
<div id="point-estimates-and-hypothesis-tests" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Point estimates and Hypothesis tests<a href="sec-allocation.html#point-estimates-and-hypothesis-tests" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First of all, we can tabulate the results of a trial with a binary outcome like this:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="left">Successes</th>
<th align="left">Failures</th>
<th align="left">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Treatment</strong></td>
<td align="left"><span class="math inline">\(r_T\)</span></td>
<td align="left"><span class="math inline">\(n_T-r_T\)</span></td>
<td align="left"><span class="math inline">\(n_T\)</span></td>
</tr>
<tr class="even">
<td><strong>Control</strong></td>
<td align="left"><span class="math inline">\(r_C\)</span></td>
<td align="left"><span class="math inline">\(n_C-r_C\)</span></td>
<td align="left"><span class="math inline">\(n_C\)</span></td>
</tr>
<tr class="odd">
<td><strong>Total</strong></td>
<td align="left"><span class="math inline">\(r\)</span></td>
<td align="left"><span class="math inline">\(n - r\)</span></td>
<td align="left"><span class="math inline">\(n\)</span></td>
</tr>
</tbody>
</table>
<p>Note that because this is a table of observed values, they are now all in lower case.</p>
<p>We can estimate <span class="math inline">\(\pi_C\)</span> and <span class="math inline">\(\pi_T\)</span> by the sample proportions</p>
<p><span class="math display">\[
\begin{aligned}
p_C &amp;= \frac{r_C}{n_C}\\
p_T &amp;= \frac{r_T}{n_T}
\end{aligned}.
\]</span></p>
<p>We know from the properties of the binomial distribtion that <span class="math inline">\(\operatorname{E}\left(p_C\right) = \pi_C\)</span> and
<span class="math display">\[\operatorname{Var}\left(p_C\right) = \frac{\pi_C\left(1-\pi_C\right)}{n_C},\]</span>
and similarly for <span class="math inline">\(\operatorname{E}\left(p_T\right)\)</span> and <span class="math inline">\(\operatorname{Var}\left(p_T\right)\)</span>.</p>
<p>If we think in terms of individual participants, we have the variable <span class="math inline">\(y_{iC}\)</span> for the outcome of the <span class="math inline">\(i\)</span>-th patient in group <span class="math inline">\(C\)</span>, with <span class="math inline">\(y_{iC}=1\)</span> if the participant’s outcome is ‘success’ and <span class="math inline">\(y_{iC}=0\)</span> otherwise. Then we have</p>
<p><span class="math display">\[r_C = \sum\limits_{i=1}^{n_C} y_{iC},\]</span>
and similarly for group <span class="math inline">\(T\)</span>. Since <span class="math inline">\(p_C\)</span> and <span class="math inline">\(p_T\)</span> are therefore sample means, we can apply the Central Limit Theorem to conclude that <span class="math inline">\(p_C\)</span> and <span class="math inline">\(p_P\)</span> can be approximated by normal distributions:</p>
<p><span class="math display">\[
\begin{aligned}
p_C &amp; \sim N\left(\pi_C,\, \frac{\pi_C\left(1-\pi_c\right)}{n_C}\right)\\
p_T &amp; \sim N\left(\pi_T,\, \frac{\pi_T\left(1-\pi_T\right)}{n_T}\right).
\end{aligned}
\]</span></p>
<p>This means we can test the null hypothesis that <span class="math inline">\(\pi_C = \pi_T\)</span> by referring our observed value of <span class="math inline">\(p_T - p_C\)</span> to a normal distribution with mean 0 and variance</p>
<p><span class="math display">\[ \frac{\pi_T\left(1-\pi_T\right)}{n_T} + \frac{\pi_C\left(1-\pi_c\right)}{n_C},\]</span></p>
<p>which we can approximate by substituting in <span class="math inline">\(p_C\)</span> and <span class="math inline">\(p_T\)</span>.</p>
<p>However, since under the null hypothesis <span class="math inline">\(\pi_C = \pi_T = \pi\)</span>, it would be more appropriate to use this as the common variance. In this case, the variance of <span class="math inline">\(p_T - p_C\)</span> becomes</p>
<p><span class="math display">\[\pi\left(1-\pi\right)\left(\frac{1}{n_C} + \frac{1}{n_T}\right), \]</span>
and in calculations we replace <span class="math inline">\(\pi\)</span> with <span class="math inline">\(p = r/n\)</span>.</p>
<p>Putting all this together, our test statistic is</p>
<p><span class="math display">\[Z = \frac{p_T - p_C}{\sqrt{p\left(1-p\right)\left(\frac{1}{n_T} + \frac{1}{n_C}\right)}}.\]</span></p>
<div class="example">
<p><span id="exm:unlabeled-div-10" class="example"><strong>Example 4.2  </strong></span>The data in this example comes from <span class="citation">al (<a href="#ref-strep_tb">1948</a>)</span>, in which 109 patients with tuberculosis were assigned to either receive Streptomycin, or the control group. The data include several other covariates, including gender, baseline condition (good, fair or poor) and whether the patient had developed resistance to streptomycin after 6 months.</p>
<pre><code>##               improved
## arm            FALSE TRUE
##   Streptomycin    17   38
##   Control         35   17</code></pre>
<p>We therefore have</p>
<p><span class="math display">\[
\begin{aligned}
n_C &amp; = 52 \\
n_T &amp; = 55 \\
p_C &amp; = \frac{17}{17+35} &amp; = 0.327\\
p_T &amp; = \frac{38}{38+17} &amp; = 0.691\\
p &amp; = \frac{38+17}{107} &amp;= 0.514.
\end{aligned}
\]</span>
and can calculate our <span class="math inline">\(Z\)</span> statistic to be</p>
<p><span class="math display">\[
\begin{aligned}
Z &amp; = \frac{0.691 - 0.327}{\sqrt{0.514\left(1-0.514\right)\left(\frac{1}{52} + \frac{1}{55}\right)}}\\
&amp; = 3.765.
\end{aligned}
\]</span></p>
<p>Finally, we can find the <span class="math inline">\(p\)</span>-value of this test statistic (making sure to have two tails!)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="sec-allocation.html#cb2-1" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">pnorm</span>(<span class="fl">3.765</span>, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] 0.0001665491</code></pre>
<p>So we can reject the hypothesis that streptomycin has no effect on tuberculosis at the <span class="math inline">\(\alpha=0.05\)</span> level (and indeed many lower levels).</p>
</div>
<div id="an-alternative-approach-chi-squared" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> An alternative approach: chi-squared<a href="sec-allocation.html#an-alternative-approach-chi-squared" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Another way to approach this would be to conduct a <strong>chi-squared</strong> test.</p>
<p>In a chi-squared test, we first calculate the <strong>expected</strong> values <span class="math inline">\(\left(E_i\right)\)</span> in each box of the summary table, and compare them to the <strong>observed</strong> values <span class="math inline">\(\left(O_i\right)\)</span> by finding the summary statistic</p>
<p><span class="math display">\[ X^2 = \sum \frac{\left(o_i - e_i\right)^2}{e_i}.\]</span></p>
<p>Under the null hypothesis (that <span class="math inline">\(p_C = p_T\)</span>) this has a <span class="math inline">\(\chi^2\)</span> distribution with one degree of freedom. We see that the larger the differences between the observed and expected values, relative to the expected values, the larger the test statistic, and therefore the less probably under the <span class="math inline">\(\chi^2_1\)</span> distribution.</p>
<div class="example">
<p><span id="exm:unlabeled-div-11" class="example"><strong>Example 4.3  </strong></span>Continuing our streptomycin example, we can calculate a table of expected values by observing that proportion <span class="math inline">\(p=0.514\)</span> of the total number of patients were improved. There are 52 in the control group, therefore we expect <span class="math inline">\(0.514\times 52 = 26.73\)</span> improved patients in the control group, and by the same logic <span class="math inline">\(0.514\times 55 = 28.27\)</span> in the treatment group. Our expected table is therefore</p>
<pre><code>##               improved
## arm             FALSE   TRUE
##   Streptomycin 26.730 28.270
##   Control      25.272 26.728</code></pre>
<p>We can therefore calculate the <span class="math inline">\(\chi^2\)</span> statistic by looping through the elements of the tables:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="sec-allocation.html#cb5-1" tabindex="-1"></a>sum_chi_sq <span class="ot">=</span> <span class="dv">0</span> <span class="co"># set a running total going </span></span>
<span id="cb5-2"><a href="sec-allocation.html#cb5-2" tabindex="-1"></a><span class="co"># in the following, tab_obs is the table of observed values and</span></span>
<span id="cb5-3"><a href="sec-allocation.html#cb5-3" tabindex="-1"></a><span class="co"># tab_exp is the table of expected values</span></span>
<span id="cb5-4"><a href="sec-allocation.html#cb5-4" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb5-5"><a href="sec-allocation.html#cb5-5" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb5-6"><a href="sec-allocation.html#cb5-6" tabindex="-1"></a>    tmp <span class="ot">=</span> ((tab_obs[i,j] <span class="sc">-</span> tab_exp[i,j])<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>tab_exp[i,j]</span>
<span id="cb5-7"><a href="sec-allocation.html#cb5-7" tabindex="-1"></a>    sum_chi_sq <span class="ot">=</span> sum_chi_sq <span class="sc">+</span> tmp</span>
<span id="cb5-8"><a href="sec-allocation.html#cb5-8" tabindex="-1"></a>  }</span>
<span id="cb5-9"><a href="sec-allocation.html#cb5-9" tabindex="-1"></a>}</span>
<span id="cb5-10"><a href="sec-allocation.html#cb5-10" tabindex="-1"></a>sum_chi_sq</span></code></pre></div>
<pre><code>## [1] 14.17595</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="sec-allocation.html#cb7-1" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">pchisq</span>(sum_chi_sq, <span class="at">df=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.0001664847</code></pre>
<p>and again we have a very significant result.</p>
<p>In fact, these two tests are almost equivalent, and we have that <span class="math inline">\(\sqrt{X^2} = Z\)</span>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="sec-allocation.html#cb9-1" tabindex="-1"></a><span class="fu">sqrt</span>(sum_chi_sq)</span></code></pre></div>
<pre><code>## [1] 3.765097</code></pre>
</div>
</div>
<div id="likelihood-a-more-rigorous-way" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Likelihood: A more rigorous way<a href="sec-allocation.html#likelihood-a-more-rigorous-way" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Our method above was quite informal, and also made heavy use of the central limit theorem. We can use maximum likelhood to derive a more formally justified test for binary outcomes. This also lays a good foundation for more complex situations.</p>
<p>Earlier we set up notation <span class="math inline">\(y_{iC}\)</span> to be outcome variable (0 or 1, in this case) of the <span class="math inline">\(i\)</span>-th participant in the control group (and so on), and we will use that here.</p>
<p>The contribution of the <span class="math inline">\(i\)</span>-th patient in group <span class="math inline">\(C\)</span> to the likelihood is</p>
<p><span class="math display">\[\pi_C^{y_{iC}}\left(1 - \pi_C\right)^{y_{iC}} \]</span>
(remember we can ignore multiplicative constant terms). Combining all <span class="math inline">\(n_C\)</span> patients in group <span class="math inline">\(C\)</span>, their contribution will be</p>
<p><span class="math display">\[ \pi_C^{r_C}\left(1-\pi_C\right)^{n_C - r_C},\]</span>
where <span class="math inline">\(r_C\)</span> is the number of ‘successes’ in group <span class="math inline">\(C\)</span>. Similarly for the treatment group we will have</p>
<p><span class="math display">\[ \pi_T^{r_T}\left(1-\pi_T\right)^{n_T - r_T}.\]</span>
Gathering these terms together we can find the complete likelihood function</p>
<p><span class="math display">\[
\begin{aligned}
L\left(\pi_C,\pi_T \mid \left\lbrace y_{iC}\right\rbrace, \left\lbrace y_{iT}\right\rbrace \right) &amp;
  L\left( \pi_C,\pi_T \mid {n_C,n_T, r_C, r_T}\right)\\
  &amp; = \pi_C^{r_C}\left(1-\pi_C\right)^{n_C - r_C}\pi_T^{r_T}\left(1-\pi_T\right)^{n_T - r_T}.
\end{aligned}
\]</span>
The log-likelihood is therefore</p>
<p><span class="math display">\[ l\left( \pi_C,\pi_T \mid {n_C,n_T, r_C, r_T}\right) = r_C\log\pi_C + \left(n_C-r_C\right)\log\left(1-\pi_C\right) + r_T\log\pi_T + \left(n_T-r_T\right)\log\left(1-\pi_T\right).\]</span>
If we differentiate with respect to <span class="math inline">\(\pi_C\)</span>, we find</p>
<p><span class="math display">\[\frac{\mathrm{d} l\left( \pi_C,\pi_T \mid {n_C,n_T, r_C, r_T}\right)}{\mathrm{d}\pi_C} = \frac{r_C}{\pi_C} - \frac{n_C-r_C}{1-\pi_C}.\]</span>
Setting this to zero we find (reassuringly!) that <span class="math inline">\(\hat\pi_C = \frac{r_C}{n_C}\)</span>. We can repeat this exercise for <span class="math inline">\(\pi_T\)</span>. If we assume that there is one common probability <span class="math inline">\(\pi\)</span> of success, we can find <span class="math inline">\(\hat\pi\)</span> by maximising
<span class="math inline">\(l\left(\pi,\pi \mid {n_C,n_T, r_C, r_T}\right)\)</span> with respect to <span class="math inline">\(\pi\)</span>, and again this works out to be <span class="math inline">\(\frac{r_{C} + r_T}{n}\)</span> as before.</p>
<p>We can use these to construct a <strong>likelihood ratio test</strong>, by calculating</p>
<p><span class="math display">\[
\begin{aligned}
\lambda_{LR} = &amp; -2\left[l\left( \hat\pi,\hat\pi \mid {n_C,n_T, r_C, r_T}\right) - l\left( \hat\pi_C,\hat\pi_T \mid {n_C,n_T, r_C, r_T}\right)\right]\\
=  &amp; 2\left[\underbrace{r_C\log\frac{r_C}{n_C} + \left(n_C-r_C\right)\log\left(1-\frac{r_C}{n_C}\right) + r_T\log\frac{r_T}{n_T} + \left(n_T-r_T\right)\log\left(1-\frac{r_T}{n_T}\right) }_{l\left( \hat\pi_C,\hat\pi_T \mid {n_C,n_T, r_C, r_T}\right)} \right. \\
&amp;\;\;\;\;\;\; \left. - \underbrace{\Big(r\log\left(p\right) + \left(n-r\right)\log\left(1-p\right)\Big)}_{l\left( \hat\pi,\hat\pi \mid {n_C,n_T, r_C, r_T}\right)}\right]\\
=&amp; 2\left[\underbrace{r_C \log\left(\frac{r_C}{n_C p}\right)}_{\text{Group }C\text{ success}} + \underbrace{\left(n_C - r_C\right)\log\left(\frac{n_C - r_C}{n_C\left(1-p\right)}\right)}_{\text{Group }C\text{ fail}} \right.\\
&amp; \;\;\;\;\;\; \left.+ \underbrace{r_T \log\left(\frac{r_T}{n_T p}\right)}_{\text{Group }T\text{ success}} + \underbrace{\left(n_T - r_T\right)\log\left(\frac{n_T - r_T}{n_T\left(1-p\right)}\right)}_{\text{Group }T\text{ fail}}\right]
\end{aligned}
\]</span>
where we use <span class="math inline">\(p,\, r,\, n\)</span> to denote the pooled values (<span class="math inline">\(n = n_C + n_T\)</span> etc.).</p>
<p>Each term in the final line corresponds to a subgroup of the participants, as labelled, and if we rearrange them slightly we see that this can be re-written as</p>
<p><span class="math display">\[\lambda_{LR} = 2 \sum\limits_{i\in G} o_i \log\left(\frac{o_i}{e_i}\right),\]</span>
where <span class="math inline">\(G\)</span> is the set of subgroups (group <span class="math inline">\(C\)</span> success etc.). Under the null hypothesis that <span class="math inline">\(\pi_C = \pi_T = \pi\)</span>, and for sufficiently large <span class="math inline">\(n_C,\;n_T\)</span>, <span class="math inline">\(\lambda_{LR}\)</span> has a <span class="math inline">\(\chi^2\)</span> distribution with one degree of freedom.</p>
<div class="example">
<p><span id="exm:unlabeled-div-12" class="example"><strong>Example 4.4  </strong></span>Continuing with the streptomycin example, we can calculate this new test statistic in R by looping through the subgroups.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="sec-allocation.html#cb11-1" tabindex="-1"></a>sum_LR <span class="ot">=</span> <span class="dv">0</span> <span class="co"># set a running total going </span></span>
<span id="cb11-2"><a href="sec-allocation.html#cb11-2" tabindex="-1"></a><span class="co"># in the following, tab_obs is the table of observed values and</span></span>
<span id="cb11-3"><a href="sec-allocation.html#cb11-3" tabindex="-1"></a><span class="co"># tab_exp is the table of expected values</span></span>
<span id="cb11-4"><a href="sec-allocation.html#cb11-4" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb11-5"><a href="sec-allocation.html#cb11-5" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb11-6"><a href="sec-allocation.html#cb11-6" tabindex="-1"></a>    tmp <span class="ot">=</span> tab_obs[i,j] <span class="sc">*</span> <span class="fu">log</span>(tab_obs[i,j]<span class="sc">/</span>tab_exp[i,j])</span>
<span id="cb11-7"><a href="sec-allocation.html#cb11-7" tabindex="-1"></a>    sum_LR <span class="ot">=</span> sum_LR <span class="sc">+</span> tmp</span>
<span id="cb11-8"><a href="sec-allocation.html#cb11-8" tabindex="-1"></a>  }</span>
<span id="cb11-9"><a href="sec-allocation.html#cb11-9" tabindex="-1"></a>}</span>
<span id="cb11-10"><a href="sec-allocation.html#cb11-10" tabindex="-1"></a>teststat_LR <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>sum_LR</span>
<span id="cb11-11"><a href="sec-allocation.html#cb11-11" tabindex="-1"></a>teststat_LR</span></code></pre></div>
<pre><code>## [1] 14.5028</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="sec-allocation.html#cb13-1" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">pchisq</span>(teststat_LR, <span class="at">df=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.0001399516</code></pre>
<p>Not surprisingly, this value is quite close to the one we obtained earlier!</p>
</div>
<pre><code>## [1] 0.008887785</code></pre>
<pre><code>## [1] 6.845238</code></pre>
<pre><code>## [1] 0.008887785</code></pre>
<pre><code>## [1] 7.333818</code></pre>
<pre><code>## [1] 0.006766917</code></pre>
</div>
</div>
<div id="measures-of-difference-for-binary-data" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Measures of difference for binary data<a href="sec-allocation.html#measures-of-difference-for-binary-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the above example the question we were interested in was ‘is what we’ve observed statistically significant?’ and in our streptomycin example the answer was a resounding ‘Yes!’. However, if we then ask questions like ‘How big is the difference between the effects of each treatment?’ or ‘What is the treatment effect?’, things get a bit less clear.</p>
<p>In the continuous case, it made sense to simply think about the treatment effect as the difference <span class="math inline">\(\mu_T - \mu_C\)</span> between outcomes. However, in the binary case there are a few different ways we can think of the difference between two proportions <span class="math inline">\(\pi_C\)</span> and <span class="math inline">\(\pi_T\)</span>, and each of them requires a different approach.</p>
<div id="absolute-risk-difference-and-number-needed-to-treat" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Absolute risk difference and Number Needed to Treat<a href="sec-allocation.html#absolute-risk-difference-and-number-needed-to-treat" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <strong>absolute risk difference</strong> is</p>
<p><span class="math display">\[\text{ARD} = \pi_T - \pi_C,\]</span>
and is sometimes used. However, it loses a lot of information that we’d probably like to keep in some how. For example, suppose a treatment reduces the incidence of some terrible symptom from <span class="math inline">\(\pi_C=0.03\)</span> to <span class="math inline">\(\pi_T=0.01\)</span>. The absolute risk difference is <span class="math inline">\(0.02\)</span> here. For some other treatment that results in a reduction from <span class="math inline">\(\pi_C=0.57\)</span> to <span class="math inline">\(\pi_T = 0.55\)</span> we have the same absolute risk difference, even though it feels (and is!) a much less significant reduction.</p>
<p>It is useful though to remember that usually these numbers are about people. If the outcome is ‘cured’ or ‘not cured’, then for some cohort of <span class="math inline">\(N\)</span> patients, <span class="math inline">\(N\times\text{ARD}\)</span> is the number of extra patients you would expect to cure if you used treatment <span class="math inline">\(T\)</span> instead of treatment <span class="math inline">\(C\)</span> (which may be nothing or may some usual course of treatment).</p>
<p>Linked to this is the <strong>number needed to treat</strong> (NNT), which is defined as</p>
<p><span class="math display">\[ \text{NNT} = \frac{1}{\pi_T - \pi_C} = \frac{1}{\text{ARD}}. \]</span>
The NNT is the number of patients you’d need to treat (with treatment <span class="math inline">\(T\)</span> rather than <span class="math inline">\(C\)</span>) before you would bring benefit to one extra patient. The website <a href="https://thennt.com/">TheNNT</a> collects together results from many clinical trials and uses the NNT as a summary. Some of the results are quite surprising, compared to how effective we think medicines are!</p>
<p>The NNT is popular as a clinical benchmark, and provides useful intuition in terms of the number of people it will help. For example, if <span class="math inline">\(\pi_T = 0.25,\,\pi_C=0.2\)</span>, then <span class="math inline">\(\text{ARD} = 0.05\)</span> and <span class="math inline">\(\text{NNT} = 20.\)</span> After treating 20 patients with treatment <span class="math inline">\(C\)</span> we expect to cure (say) 4, whereas treating 20 patients with treatment <span class="math inline">\(T\)</span> it is expected that we will cure 5. For very small proportions, the NNT can be large even for what appears to be an important difference. For example, if <span class="math inline">\(\pi_C=0.005\)</span> and <span class="math inline">\(\pi_T = 0.015\)</span> then <span class="math inline">\(\text{ARD}=0.01\)</span> and <span class="math inline">\(\text{NNT}=100\)</span>. It might be decided that the necessary changes and costs are not worth it for such a small difference. That said, the NNT is not the easiest statistic to work with, as we shall see!</p>
</div>
<div id="risk-ratio-rr" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Risk Ratio (RR)<a href="sec-allocation.html#risk-ratio-rr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <strong>risk ratio</strong> is defined as</p>
<p><span class="math display">\[\text{RR} = \frac{\pi_C}{\pi_T}\]</span></p>
</div>
<div id="odds-ratio-or" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Odds ratio (OR)<a href="sec-allocation.html#odds-ratio-or" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <strong>odds ratio</strong> is defined as
<span class="math display">\[\text{OR} = \frac{\pi_T/\left(1-\pi_T\right)}{\pi_C/\left(1-\pi_C\right)}\]</span></p>
</div>
</div>
<div id="accounting-for-covariates-logistic-regression" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Accounting for covariates: logistic regression<a href="sec-allocation.html#accounting-for-covariates-logistic-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-strep_tb" class="csl-entry">
al, Geoffrey Marshall et. 1948. <span>“STREPTOMYCIN TREATMENT OF PULMONARY TUBERCULOSIS a MEDICAL RESEARCH COUNCIL INVESTIGATION.”</span> <em>British Medical Journal</em>. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2091872/pdf/brmedj03701-0007.pdf">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2091872/pdf/brmedj03701-0007.pdf</a>.
</div>
<div id="ref-altman1999randomise" class="csl-entry">
Altman, Douglas G, and J Martin Bland. 1999a. <span>“How to Randomise.”</span> <em>Bmj</em> 319 (7211): 703–4.
</div>
<div id="ref-altman1999treatment" class="csl-entry">
———. 1999b. <span>“Treatment Allocation in Controlled Trials: Why Randomise?”</span> <em>Bmj</em> 318 (7192): 1209–9.
</div>
<div id="ref-smith1994randomised" class="csl-entry">
Smith, AC, JF Dowsett, RCG Russell, ARW Hatfield, and PB Cotton. 1994. <span>“Randomised Trial of Endoscopic Steriting Versus Surgical Bypass in Malignant Low Bileduct Obstruction.”</span> <em>The Lancet</em> 344 (8938): 1655–60.
</div>
<div id="ref-treasure1998minimisation" class="csl-entry">
Treasure, Tom, and Kenneth D MacRae. 1998. <span>“Minimisation: The Platinum Standard for Trials?: Randomisation Doesn’t Guarantee Similarity of Groups; Minimisation Does.”</span> <em>Bmj</em>. British Medical Journal Publishing Group.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bias.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="working-with-survival-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
